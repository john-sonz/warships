(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.config = {
    board: [10, 10],
    shipsSizes: [1, 1, 1, 1, 2, 2, 2, 3, 3, 4]
};

},{}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var State;
(function (State) {
    State[State["Empty"] = 0] = "Empty";
    State[State["Taken"] = 1] = "Taken";
    State[State["Hit"] = 2] = "Hit";
    State[State["Miss"] = 3] = "Miss";
})(State || (State = {}));
;
class Board {
    constructor(width, height) {
        this.board = [];
        this.shots = [];
        this.htmlBoard = [];
        this.ships = [];
        this.lastProposed = null;
        this.allowShoot = false;
        [this.width, this.height] = [width, height];
        for (let i = 0; i < height; i++) {
            const row = [];
            for (let j = 0; j < width; j++) {
                row.push(State.Empty);
                this.shots.push([i, j]);
            }
            this.board.push(row);
        }
    }
    createHTMLBoard(shipSetter = null, board2 = null) {
        this.boardContainer = document.createElement("div");
        this.boardContainer.className = "board";
        console.log(shipSetter);
        for (let i = 0; i < this.height; i++) {
            const row = [];
            const rowDiv = document.createElement('div');
            rowDiv.className = "row";
            for (let j = 0; j < this.width; j++) {
                const cell = document.createElement("div");
                if (shipSetter) {
                    cell.addEventListener('mouseover', (e) => this.checkShip(e, shipSetter, true));
                    cell.addEventListener('click', (e) => this.checkAndAddShip(e, shipSetter));
                }
                else {
                    cell.addEventListener('click', (e) => this.shoot(i, j, board2));
                }
                cell.className = "cell";
                cell.id = `${j}-${i}`;
                row.push(cell);
                rowDiv.appendChild(cell);
            }
            this.htmlBoard.push(row);
            this.boardContainer.appendChild(rowDiv);
        }
    }
    getHMTLBoard() { return this.boardContainer; }
    addShip(x, y, length, direction, show = false) {
        for (let i = 0; i < length; i++) {
            let [X, Y] = [x, y];
            if (direction)
                Y = y + i;
            else
                X = x + i;
            this.board[Y][X] = State.Taken;
            if (show) {
                this.htmlBoard[Y][X].classList.add('blue');
            }
        }
    }
    drawShips(shipSizes) {
        while (shipSizes.length > 0) {
            const size = shipSizes.pop();
            let found = false;
            while (!found) {
                let [x, y, direction] = [Math.floor(Math.random() * this.width), Math.floor(Math.random() * this.height), Math.random() < 0.5];
                if (x > this.width - size && !direction) {
                    continue;
                }
                if (y > this.height - size && direction) {
                    continue;
                }
                if (size === 4) {
                    this.addShip(x, y, size, direction);
                    break;
                }
                const s = {
                    x,
                    y,
                    direction,
                    size
                };
                const [shipsPos, surroundings] = generateCheckPositions(s, this.width, this.height);
                found = this.checkPositions(shipsPos, surroundings);
                if (found)
                    this.addShip(x, y, size, direction);
            }
        }
    }
    checkPositions(ships, surroundings) {
        const s = ships.filter(pos => {
            return this.board[pos[1]][pos[0]] === State.Empty;
        });
        const sur = surroundings.filter(pos => {
            return this.board[pos[1]][pos[0]] === State.Empty;
        });
        return (ships.length === s.length && surroundings.length === sur.length);
    }
    viewShip(color, s) {
        const { x, y, direction, size } = s;
        for (let i = 0; i < size; i++) {
            let [X, Y] = [x, y];
            if (direction)
                Y = y + i;
            else
                X = x + i;
            if (X >= 0 && X < this.width && Y >= 0 && Y < this.height) {
                this.htmlBoard[Y][X].style.backgroundColor = color;
            }
        }
        this.lastProposed = s;
    }
    checkShip(e, shipSetter, view) {
        if (!shipSetter.selected)
            return false;
        const el = e.target;
        const pos = el.id.split("-").map(a => parseInt(a));
        const ship = {
            x: pos[0],
            y: pos[1],
            direction: shipSetter.direction,
            size: shipSetter.selected
        };
        if (ship.x + ship.size > this.width && !ship.direction) {
            ship.x = this.width - ship.size;
        }
        if (ship.y + ship.size > this.height && ship.direction) {
            ship.y = this.width - ship.size;
        }
        const [shipsPos, surroundings] = generateCheckPositions(ship, this.width, this.height);
        const shipValid = this.checkPositions(shipsPos, surroundings);
        if (view) {
            if (this.lastProposed) {
                this.viewShip("", this.lastProposed);
            }
            this.viewShip(shipValid ? "green" : "red", ship);
        }
        return shipValid;
    }
    updateLastShip(dir) {
        if (!this.lastProposed)
            return;
        const s = Object.assign({}, this.lastProposed);
        s.direction = dir;
        this.viewShip("", this.lastProposed);
        this.viewShip("green", s);
    }
    checkAndAddShip(e, shipS) {
        if (this.checkShip(e, shipS, false)) {
            this.viewShip("", this.lastProposed);
            const { x, y, direction, size } = this.lastProposed;
            this.addShip(x, y, size, direction, true);
            shipS.shipPlaced();
        }
    }
    shoot(y, x, board2) {
        if (!this.allowShoot) {
            document.getElementById('sexi-text').innerHTML = "Nie możesz teraz strzelać";
            return;
        }
        if (this.board[y][x] === State.Taken) {
            this.board[y][x] = State.Hit;
            this.htmlBoard[y][x].classList.add('hit');
            this.allowShoot = false;
            document.getElementById('sexi-text').innerHTML = "Trafiony!<br>Ruch komputera";
            board2.randomShoot(this).then(res => {
                this.allowShoot = true;
                document.getElementById('sexi-text').innerHTML = "Twój ruch";
            });
        }
        if (this.board[y][x] === State.Empty) {
            this.board[y][x] = State.Miss;
            this.htmlBoard[y][x].classList.add('miss');
            document.getElementById('sexi-text').innerHTML = "Pudło<br>Ruch komputera";
            this.allowShoot = false;
            board2.randomShoot(this).then(res => {
                this.allowShoot = true;
                document.getElementById('sexi-text').innerHTML = "Twój ruch";
            });
            return;
        }
        if (this.board[y][x] === State.Miss || this.board[y][x] === State.Hit) {
            document.getElementById('sexi-text').innerHTML = "Już tam strzeliłeś";
        }
    }
    randomShoot(board2) {
        return new Promise((resolve, reject) => {
            const [y, x] = this.shots[Math.floor(Math.random() * this.shots.length)];
            console.log(this.htmlBoard[y][x]);
            if (this.board[y][x] === State.Hit) {
                this.htmlBoard[y][x].classList.add('red');
            }
            else {
                this.htmlBoard[y][x].classList.add('green');
            }
            setTimeout(resolve, 1000);
        });
    }
}
exports.default = Board;
function generateCheckPositions(ship, width, height) {
    const { x, y, size, direction } = ship;
    const positions = [];
    for (let i = -1; i < 2; i++) {
        if (!direction) {
            for (let j = -1; j < size + 1; j++) {
                positions.push([x + j, y + i]);
            }
        }
        else {
            for (let j = -1; j < size + 1; j++) {
                positions.push([x + i, y + j]);
            }
        }
    }
    const shipPos = positions.splice(size + 3, size);
    return [shipPos, positions.filter(pos => {
            return (pos[0] >= 0 && pos[0] < width) && (pos[1] >= 0 && pos[1] < height);
        })];
}

},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class ShipSetter {
    constructor(ships) {
        this.placed = 0;
        this.getContainer = () => this.container;
        this.updateDirection = () => this.direction = !this.direction;
        this.isSetting = () => this.selected != null;
        this.direction = true;
        this.ships = ships.slice();
        this.container = document.getElementById("ships");
        this.selected = Math.max(...ships);
        for (let i = ships.length - 1; i >= 0; i--) {
            const ship = document.createElement("div");
            ship.id = `${ships[i]}`;
            ship.className = "ship";
            ship.addEventListener("click", e => {
                const a = document.getElementsByClassName("selected")[0];
                if (a)
                    a.classList.remove("selected");
                const el = e.currentTarget;
                el.classList.add('selected');
                this.selected = parseInt(el.id);
            });
            for (let j = 0; j < ships[i]; j++) {
                const cell = document.createElement("div");
                ship.appendChild(cell);
            }
            this.container.appendChild(ship);
        }
        document.getElementsByClassName('ship')[0].classList.add("selected");
    }
    shipPlaced() {
        document.getElementsByClassName("selected")[0].remove();
        this.selected = null;
        this.placed++;
        if (this.placed === this.ships.length) {
            const startButton = document.getElementById('start');
            startButton.disabled = false;
            document.getElementById('ships').remove();
            const sexi = document.getElementById('sexi-text');
            sexi.innerHTML = "Rozpocznij grę";
        }
    }
}
exports.default = ShipSetter;

},{}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const config_1 = require("./../config");
const Board_1 = require("./Board");
const ShipSetter_1 = require("./ShipSetter");
const { board, shipsSizes } = config_1.config;
const machineBoard = new Board_1.default(board[0], board[1]);
const playerBoard = new Board_1.default(board[0], board[1]);
const shipSetter = new ShipSetter_1.default(shipsSizes);
machineBoard.createHTMLBoard(null, playerBoard);
playerBoard.createHTMLBoard(shipSetter);
document.getElementById("machine").appendChild(machineBoard.getHMTLBoard());
document.getElementById("player").appendChild(playerBoard.getHMTLBoard());
machineBoard.drawShips(shipsSizes.slice());
document.body.addEventListener("contextmenu", e => {
    e.preventDefault();
    if (shipSetter.isSetting()) {
        shipSetter.updateDirection();
        playerBoard.updateLastShip(shipSetter.direction);
    }
});
const startButton = document.getElementById('start');
startButton.addEventListener('click', (e) => {
    document.getElementById('sexi-text').innerHTML = "Twój ruch";
    machineBoard.allowShoot = true;
});

},{"./../config":1,"./Board":2,"./ShipSetter":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29uZmlnLnRzIiwic3JjL3RzL0JvYXJkLnRzIiwic3JjL3RzL1NoaXBTZXR0ZXIudHMiLCJzcmMvdHMvbWFpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDS2EsUUFBQSxNQUFNLEdBQVc7SUFDMUIsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUNmLFVBQVUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztDQUM3QyxDQUFBOzs7OztBQ0VELElBQUssS0FLSjtBQUxELFdBQUssS0FBSztJQUNOLG1DQUFLLENBQUE7SUFDTCxtQ0FBSyxDQUFBO0lBQ0wsK0JBQUcsQ0FBQTtJQUNILGlDQUFJLENBQUE7QUFDUixDQUFDLEVBTEksS0FBSyxLQUFMLEtBQUssUUFLVDtBQUFBLENBQUM7QUFFRixNQUFxQixLQUFLO0lBVXRCLFlBQVksS0FBYSxFQUFFLE1BQWM7UUFUekMsVUFBSyxHQUFlLEVBQUUsQ0FBQztRQUN2QixVQUFLLEdBQWUsRUFBRSxDQUFBO1FBR3RCLGNBQVMsR0FBb0IsRUFBRSxDQUFDO1FBRWhDLFVBQUssR0FBVyxFQUFFLENBQUM7UUFDbkIsaUJBQVksR0FBZ0IsSUFBSSxDQUFDO1FBQ2pDLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFFeEIsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztRQUM1QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzdCLE1BQU0sR0FBRyxHQUFhLEVBQUUsQ0FBQztZQUN6QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUM1QixHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUMxQjtZQUNELElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFBO1NBQ3ZCO0lBQ0wsQ0FBQztJQUNELGVBQWUsQ0FBQyxhQUF5QixJQUFJLEVBQUUsU0FBZ0IsSUFBSTtRQUMvRCxJQUFJLENBQUMsY0FBYyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDbkQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDeEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDbEMsTUFBTSxHQUFHLEdBQWtCLEVBQUUsQ0FBQztZQUM5QixNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdDLE1BQU0sQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO1lBQ3pCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUNqQyxNQUFNLElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUMzQyxJQUFJLFVBQVUsRUFBRTtvQkFDWixJQUFJLENBQUMsZ0JBQWdCLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFDL0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztpQkFFOUU7cUJBQ0k7b0JBQ0QsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUE7aUJBQ2xFO2dCQUNELElBQUksQ0FBQyxTQUFTLEdBQUcsTUFBTSxDQUFDO2dCQUN4QixJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUN0QixHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNmLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7YUFFNUI7WUFDRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtZQUN4QixJQUFJLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUMzQztJQUNMLENBQUM7SUFDRCxZQUFZLEtBQUssT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFBLENBQUMsQ0FBQztJQUM3QyxPQUFPLENBQUMsQ0FBUyxFQUFFLENBQVMsRUFBRSxNQUFjLEVBQUUsU0FBa0IsRUFBRSxPQUFnQixLQUFLO1FBQ25GLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDN0IsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNwQixJQUFJLFNBQVM7Z0JBQUUsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7O2dCQUNwQixDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNmLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztZQUMvQixJQUFJLElBQUksRUFBRTtnQkFDTixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDOUM7U0FDSjtJQUNMLENBQUM7SUFDRCxTQUFTLENBQUMsU0FBbUI7UUFDekIsT0FBTyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN6QixNQUFNLElBQUksR0FBRyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDN0IsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDO1lBQ2xCLE9BQU8sQ0FBQyxLQUFLLEVBQUU7Z0JBQ1gsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQztnQkFDL0gsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7b0JBQ3JDLFNBQVM7aUJBQ1o7Z0JBQ0QsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLElBQUksU0FBUyxFQUFFO29CQUNyQyxTQUFTO2lCQUNaO2dCQUNELElBQUksSUFBSSxLQUFLLENBQUMsRUFBRTtvQkFFWixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFBO29CQUNuQyxNQUFNO2lCQUNUO2dCQUNELE1BQU0sQ0FBQyxHQUFnQjtvQkFDbkIsQ0FBQztvQkFDRCxDQUFDO29CQUNELFNBQVM7b0JBQ1QsSUFBSTtpQkFDUCxDQUFBO2dCQUNELE1BQU0sQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLEdBQUcsc0JBQXNCLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNwRixLQUFLLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUE7Z0JBQ25ELElBQUksS0FBSztvQkFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO2FBQ2xEO1NBQ0o7SUFDTCxDQUFDO0lBQ0QsY0FBYyxDQUFDLEtBQWlCLEVBQUUsWUFBd0I7UUFDdEQsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN6QixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLEtBQUssQ0FBQTtRQUNyRCxDQUFDLENBQUMsQ0FBQTtRQUNGLE1BQU0sR0FBRyxHQUFHLFlBQVksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDbEMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxLQUFLLENBQUE7UUFDckQsQ0FBQyxDQUFDLENBQUE7UUFDRixPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsTUFBTSxJQUFJLFlBQVksQ0FBQyxNQUFNLEtBQUssR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQzVFLENBQUM7SUFDRCxRQUFRLENBQUMsS0FBYSxFQUFFLENBQWM7UUFDbEMsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNwQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzNCLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDcEIsSUFBSSxTQUFTO2dCQUFFLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDOztnQkFDcEIsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDZixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRTtnQkFDdkQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQzthQUN0RDtTQUNKO1FBQ0QsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLENBQUM7SUFDMUIsQ0FBQztJQUVELFNBQVMsQ0FBQyxDQUFRLEVBQUUsVUFBc0IsRUFBRSxJQUFhO1FBQ3JELElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUTtZQUFFLE9BQU8sS0FBSyxDQUFDO1FBQ3ZDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxNQUFxQixDQUFDO1FBQ25DLE1BQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25ELE1BQU0sSUFBSSxHQUFnQjtZQUN0QixDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNULENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ1QsU0FBUyxFQUFFLFVBQVUsQ0FBQyxTQUFTO1lBQy9CLElBQUksRUFBRSxVQUFVLENBQUMsUUFBUTtTQUM1QixDQUFBO1FBQ0QsSUFBSSxJQUFJLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDcEQsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDbkM7UUFDRCxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDcEQsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDbkM7UUFDRCxNQUFNLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxHQUFHLHNCQUFzQixDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2RixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUM5RCxJQUFJLElBQUksRUFBRTtZQUNOLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtnQkFDbkIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3hDO1lBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ3BEO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDckIsQ0FBQztJQUNELGNBQWMsQ0FBQyxHQUFZO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWTtZQUFFLE9BQU87UUFDL0IsTUFBTSxDQUFDLHFCQUFRLElBQUksQ0FBQyxZQUFZLENBQUUsQ0FBQztRQUNuQyxDQUFDLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztRQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUNELGVBQWUsQ0FBQyxDQUFRLEVBQUUsS0FBaUI7UUFDdkMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFDakMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3JDLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1lBQ3BELElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQztTQUN0QjtJQUNMLENBQUM7SUFDRCxLQUFLLENBQUMsQ0FBUyxFQUFFLENBQVMsRUFBRSxNQUFhO1FBQ3JDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ2xCLFFBQVEsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxHQUFHLDJCQUEyQixDQUFDO1lBQzdFLE9BQU87U0FDVjtRQUNELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsS0FBSyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQztZQUM3QixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDMUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7WUFDeEIsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLEdBQUcsNkJBQTZCLENBQUM7WUFDL0UsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFBLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFBO2dCQUN0QixRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUM7WUFDakUsQ0FBQyxDQUFDLENBQUM7U0FDTjtRQUNELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsS0FBSyxFQUFFO1lBQ2xDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztZQUM5QixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDM0MsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLEdBQUcseUJBQXlCLENBQUM7WUFDM0UsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7WUFDeEIsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFBLEVBQUU7Z0JBQy9CLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFBO2dCQUN0QixRQUFRLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUM7WUFDakUsQ0FBQyxDQUFDLENBQUM7WUFDSCxPQUFPO1NBQ1Y7UUFDRCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxHQUFHLEVBQUU7WUFDbkUsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLEdBQUcsb0JBQW9CLENBQUM7U0FDekU7SUFDTCxDQUFDO0lBQ0QsV0FBVyxDQUFDLE1BQWE7UUFDckIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRTtZQUNuQyxNQUFNLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3ZFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2xDLElBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLENBQUMsR0FBRyxFQUFDO2dCQUM5QixJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7YUFDN0M7aUJBQ0c7Z0JBQ0EsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQy9DO1lBQ0QsVUFBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQTtRQUM3QixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSjtBQXBNRCx3QkFvTUM7QUFFRCxTQUFTLHNCQUFzQixDQUFDLElBQWlCLEVBQUUsS0FBYSxFQUFFLE1BQWM7SUFDNUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxHQUFHLElBQUksQ0FBQztJQUN2QyxNQUFNLFNBQVMsR0FBZSxFQUFFLENBQUE7SUFDaEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ3pCLElBQUksQ0FBQyxTQUFTLEVBQUU7WUFDWixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUNoQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNsQztTQUNKO2FBQU07WUFDSCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUNoQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNsQztTQUNKO0tBQ0o7SUFDRCxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDakQsT0FBTyxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ3BDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFBO1FBQzlFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDUixDQUFDOzs7OztBQ3pPRCxNQUFxQixVQUFVO0lBTTNCLFlBQVksS0FBZTtRQUQzQixXQUFNLEdBQVcsQ0FBQyxDQUFDO1FBMEJuQixpQkFBWSxHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDcEMsb0JBQWUsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUN6RCxjQUFTLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUM7UUExQnBDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNsRCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztRQUNuQyxLQUFLLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDeEMsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMzQyxJQUFJLENBQUMsRUFBRSxHQUFHLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDeEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxNQUFNLENBQUM7WUFDeEIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRTtnQkFDL0IsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFDLHNCQUFzQixDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6RCxJQUFHLENBQUM7b0JBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ3JDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxhQUE0QixDQUFDO2dCQUMxQyxFQUFFLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDN0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3BDLENBQUMsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDL0IsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDM0MsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUMxQjtZQUNELElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1NBQ3BDO1FBQ0QsUUFBUSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFekUsQ0FBQztJQUlELFVBQVU7UUFDTixRQUFRLENBQUMsc0JBQXNCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDeEQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBQ2IsSUFBRyxJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFDO1lBQ2pDLE1BQU0sV0FBVyxHQUF1QixRQUFRLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3pFLFdBQVcsQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1lBQzdCLFFBQVEsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDMUMsTUFBTSxJQUFJLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQWdCLENBQUM7WUFDakUsSUFBSSxDQUFDLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQztTQUNyQztJQUNMLENBQUM7Q0FDSjtBQTlDRCw2QkE4Q0M7Ozs7O0FDOUNELHdDQUFxQztBQUNyQyxtQ0FBNEI7QUFDNUIsNkNBQXNDO0FBRXRDLE1BQU0sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEdBQUcsZUFBTSxDQUFDO0FBRXJDLE1BQU0sWUFBWSxHQUFVLElBQUksZUFBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUMxRCxNQUFNLFdBQVcsR0FBVSxJQUFJLGVBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDekQsTUFBTSxVQUFVLEdBQUcsSUFBSSxvQkFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBRTlDLFlBQVksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ2hELFdBQVcsQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFeEMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7QUFDNUUsUUFBUSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7QUFFMUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztBQUUzQyxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsRUFBRTtJQUM5QyxDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDbkIsSUFBSSxVQUFVLENBQUMsU0FBUyxFQUFFLEVBQUU7UUFDeEIsVUFBVSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQzdCLFdBQVcsQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0tBQ3BEO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDSCxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBc0IsQ0FBQztBQUMxRSxXQUFXLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7SUFDeEMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDO0lBQzdELFlBQVksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO0FBQ25DLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW50ZXJmYWNlIENvbmZpZyB7XG4gICAgYm9hcmQ6IG51bWJlcltdO1xuICAgIHNoaXBzU2l6ZXM6IG51bWJlcltdXG59XG5cbmV4cG9ydCBjb25zdCBjb25maWc6IENvbmZpZyA9IHtcbiAgICBib2FyZDogWzEwLCAxMF0sXG4gICAgc2hpcHNTaXplczogWzEsIDEsIDEsIDEsIDIsIDIsIDIsIDMsIDMsIDRdXG59XG5cbiIsImltcG9ydCBTaGlwIGZyb20gJy4vU2hpcCc7XG5pbXBvcnQgU2hpcFNldHRlciBmcm9tICcuL1NoaXBTZXR0ZXInO1xuXG5pbnRlcmZhY2Ugc2hpcFNldHRpbmcge1xuICAgIHg6IG51bWJlcjtcbiAgICB5OiBudW1iZXI7XG4gICAgZGlyZWN0aW9uOiBib29sZWFuO1xuICAgIHNpemU6IG51bWJlcjtcbn1cblxuZW51bSBTdGF0ZSB7XG4gICAgRW1wdHksXG4gICAgVGFrZW4sXG4gICAgSGl0LFxuICAgIE1pc3Ncbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvYXJkIHtcbiAgICBib2FyZDogbnVtYmVyW11bXSA9IFtdO1xuICAgIHNob3RzOiBudW1iZXJbXVtdID0gW11cbiAgICB3aWR0aDogbnVtYmVyO1xuICAgIGhlaWdodDogbnVtYmVyO1xuICAgIGh0bWxCb2FyZDogSFRNTEVsZW1lbnRbXVtdID0gW107XG4gICAgYm9hcmRDb250YWluZXI6IEhUTUxFbGVtZW50O1xuICAgIHNoaXBzOiBTaGlwW10gPSBbXTtcbiAgICBsYXN0UHJvcG9zZWQ6IHNoaXBTZXR0aW5nID0gbnVsbDtcbiAgICBhbGxvd1Nob290OiBib29sZWFuID0gZmFsc2U7XG4gICAgY29uc3RydWN0b3Iod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICAgICAgW3RoaXMud2lkdGgsIHRoaXMuaGVpZ2h0XSA9IFt3aWR0aCwgaGVpZ2h0XTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3Qgcm93OiBudW1iZXJbXSA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgcm93LnB1c2goU3RhdGUuRW1wdHkpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvdHMucHVzaChbaSxqXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmJvYXJkLnB1c2gocm93KVxuICAgICAgICB9XG4gICAgfVxuICAgIGNyZWF0ZUhUTUxCb2FyZChzaGlwU2V0dGVyOiBTaGlwU2V0dGVyID0gbnVsbCwgYm9hcmQyOiBCb2FyZCA9IG51bGwpIHtcbiAgICAgICAgdGhpcy5ib2FyZENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgdGhpcy5ib2FyZENvbnRhaW5lci5jbGFzc05hbWUgPSBcImJvYXJkXCI7XG4gICAgICAgIGNvbnNvbGUubG9nKHNoaXBTZXR0ZXIpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaGVpZ2h0OyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHJvdzogSFRNTEVsZW1lbnRbXSA9IFtdO1xuICAgICAgICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICByb3dEaXYuY2xhc3NOYW1lID0gXCJyb3dcIjtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy53aWR0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICAgICAgaWYgKHNoaXBTZXR0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW92ZXInLCAoZSkgPT4gdGhpcy5jaGVja1NoaXAoZSwgc2hpcFNldHRlciwgdHJ1ZSkpO1xuICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHRoaXMuY2hlY2tBbmRBZGRTaGlwKGUsIHNoaXBTZXR0ZXIpKTtcblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB0aGlzLnNob290KGksIGosIGJvYXJkMikpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NOYW1lID0gXCJjZWxsXCI7XG4gICAgICAgICAgICAgICAgY2VsbC5pZCA9IGAke2p9LSR7aX1gO1xuICAgICAgICAgICAgICAgIHJvdy5wdXNoKGNlbGwpO1xuICAgICAgICAgICAgICAgIHJvd0Rpdi5hcHBlbmRDaGlsZChjZWxsKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5odG1sQm9hcmQucHVzaChyb3cpXG4gICAgICAgICAgICB0aGlzLmJvYXJkQ29udGFpbmVyLmFwcGVuZENoaWxkKHJvd0Rpdik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SE1UTEJvYXJkKCkgeyByZXR1cm4gdGhpcy5ib2FyZENvbnRhaW5lciB9XG4gICAgYWRkU2hpcCh4OiBudW1iZXIsIHk6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIGRpcmVjdGlvbjogYm9vbGVhbiwgc2hvdzogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBbWCwgWV0gPSBbeCwgeV07XG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uKSBZID0geSArIGk7XG4gICAgICAgICAgICBlbHNlIFggPSB4ICsgaTtcbiAgICAgICAgICAgIHRoaXMuYm9hcmRbWV1bWF0gPSBTdGF0ZS5UYWtlbjtcbiAgICAgICAgICAgIGlmIChzaG93KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5odG1sQm9hcmRbWV1bWF0uY2xhc3NMaXN0LmFkZCgnYmx1ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGRyYXdTaGlwcyhzaGlwU2l6ZXM6IG51bWJlcltdKSB7XG4gICAgICAgIHdoaWxlIChzaGlwU2l6ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IHNoaXBTaXplcy5wb3AoKTtcbiAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xuICAgICAgICAgICAgd2hpbGUgKCFmb3VuZCkge1xuICAgICAgICAgICAgICAgIGxldCBbeCwgeSwgZGlyZWN0aW9uXSA9IFtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLndpZHRoKSwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5oZWlnaHQpLCBNYXRoLnJhbmRvbSgpIDwgMC41XTtcbiAgICAgICAgICAgICAgICBpZiAoeCA+IHRoaXMud2lkdGggLSBzaXplICYmICFkaXJlY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh5ID4gdGhpcy5oZWlnaHQgLSBzaXplICYmIGRpcmVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHNpemUgPT09IDQpIHtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFNoaXAoeCwgeSwgc2l6ZSwgZGlyZWN0aW9uKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3Qgczogc2hpcFNldHRpbmcgPSB7XG4gICAgICAgICAgICAgICAgICAgIHgsXG4gICAgICAgICAgICAgICAgICAgIHksXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgc2l6ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBbc2hpcHNQb3MsIHN1cnJvdW5kaW5nc10gPSBnZW5lcmF0ZUNoZWNrUG9zaXRpb25zKHMsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRoaXMuY2hlY2tQb3NpdGlvbnMoc2hpcHNQb3MsIHN1cnJvdW5kaW5ncylcbiAgICAgICAgICAgICAgICBpZiAoZm91bmQpIHRoaXMuYWRkU2hpcCh4LCB5LCBzaXplLCBkaXJlY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNoZWNrUG9zaXRpb25zKHNoaXBzOiBudW1iZXJbXVtdLCBzdXJyb3VuZGluZ3M6IG51bWJlcltdW10pOiBib29sZWFuIHtcbiAgICAgICAgY29uc3QgcyA9IHNoaXBzLmZpbHRlcihwb3MgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm9hcmRbcG9zWzFdXVtwb3NbMF1dID09PSBTdGF0ZS5FbXB0eVxuICAgICAgICB9KVxuICAgICAgICBjb25zdCBzdXIgPSBzdXJyb3VuZGluZ3MuZmlsdGVyKHBvcyA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ib2FyZFtwb3NbMV1dW3Bvc1swXV0gPT09IFN0YXRlLkVtcHR5XG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiAoc2hpcHMubGVuZ3RoID09PSBzLmxlbmd0aCAmJiBzdXJyb3VuZGluZ3MubGVuZ3RoID09PSBzdXIubGVuZ3RoKVxuICAgIH1cbiAgICB2aWV3U2hpcChjb2xvcjogc3RyaW5nLCBzOiBzaGlwU2V0dGluZykge1xuICAgICAgICBjb25zdCB7IHgsIHksIGRpcmVjdGlvbiwgc2l6ZSB9ID0gcztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBbWCwgWV0gPSBbeCwgeV07XG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uKSBZID0geSArIGk7XG4gICAgICAgICAgICBlbHNlIFggPSB4ICsgaTtcbiAgICAgICAgICAgIGlmIChYID49IDAgJiYgWCA8IHRoaXMud2lkdGggJiYgWSA+PSAwICYmIFkgPCB0aGlzLmhlaWdodCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaHRtbEJvYXJkW1ldW1hdLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubGFzdFByb3Bvc2VkID0gcztcbiAgICB9XG5cbiAgICBjaGVja1NoaXAoZTogRXZlbnQsIHNoaXBTZXR0ZXI6IFNoaXBTZXR0ZXIsIHZpZXc6IGJvb2xlYW4pIHtcbiAgICAgICAgaWYgKCFzaGlwU2V0dGVyLnNlbGVjdGVkKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGNvbnN0IGVsID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IHBvcyA9IGVsLmlkLnNwbGl0KFwiLVwiKS5tYXAoYSA9PiBwYXJzZUludChhKSk7XG4gICAgICAgIGNvbnN0IHNoaXA6IHNoaXBTZXR0aW5nID0ge1xuICAgICAgICAgICAgeDogcG9zWzBdLFxuICAgICAgICAgICAgeTogcG9zWzFdLFxuICAgICAgICAgICAgZGlyZWN0aW9uOiBzaGlwU2V0dGVyLmRpcmVjdGlvbixcbiAgICAgICAgICAgIHNpemU6IHNoaXBTZXR0ZXIuc2VsZWN0ZWRcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hpcC54ICsgc2hpcC5zaXplID4gdGhpcy53aWR0aCAmJiAhc2hpcC5kaXJlY3Rpb24pIHtcbiAgICAgICAgICAgIHNoaXAueCA9IHRoaXMud2lkdGggLSBzaGlwLnNpemU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNoaXAueSArIHNoaXAuc2l6ZSA+IHRoaXMuaGVpZ2h0ICYmIHNoaXAuZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICBzaGlwLnkgPSB0aGlzLndpZHRoIC0gc2hpcC5zaXplO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IFtzaGlwc1Bvcywgc3Vycm91bmRpbmdzXSA9IGdlbmVyYXRlQ2hlY2tQb3NpdGlvbnMoc2hpcCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBjb25zdCBzaGlwVmFsaWQgPSB0aGlzLmNoZWNrUG9zaXRpb25zKHNoaXBzUG9zLCBzdXJyb3VuZGluZ3MpO1xuICAgICAgICBpZiAodmlldykge1xuICAgICAgICAgICAgaWYgKHRoaXMubGFzdFByb3Bvc2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy52aWV3U2hpcChcIlwiLCB0aGlzLmxhc3RQcm9wb3NlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnZpZXdTaGlwKHNoaXBWYWxpZCA/IFwiZ3JlZW5cIiA6IFwicmVkXCIsIHNoaXApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzaGlwVmFsaWQ7XG4gICAgfVxuICAgIHVwZGF0ZUxhc3RTaGlwKGRpcjogYm9vbGVhbikge1xuICAgICAgICBpZiAoIXRoaXMubGFzdFByb3Bvc2VkKSByZXR1cm47XG4gICAgICAgIGNvbnN0IHMgPSB7IC4uLnRoaXMubGFzdFByb3Bvc2VkIH07XG4gICAgICAgIHMuZGlyZWN0aW9uID0gZGlyO1xuICAgICAgICB0aGlzLnZpZXdTaGlwKFwiXCIsIHRoaXMubGFzdFByb3Bvc2VkKTtcbiAgICAgICAgdGhpcy52aWV3U2hpcChcImdyZWVuXCIsIHMpO1xuICAgIH1cbiAgICBjaGVja0FuZEFkZFNoaXAoZTogRXZlbnQsIHNoaXBTOiBTaGlwU2V0dGVyKSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrU2hpcChlLCBzaGlwUywgZmFsc2UpKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXdTaGlwKFwiXCIsIHRoaXMubGFzdFByb3Bvc2VkKTtcbiAgICAgICAgICAgIGNvbnN0IHsgeCwgeSwgZGlyZWN0aW9uLCBzaXplIH0gPSB0aGlzLmxhc3RQcm9wb3NlZDtcbiAgICAgICAgICAgIHRoaXMuYWRkU2hpcCh4LCB5LCBzaXplLCBkaXJlY3Rpb24sIHRydWUpO1xuICAgICAgICAgICAgc2hpcFMuc2hpcFBsYWNlZCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNob290KHk6IG51bWJlciwgeDogbnVtYmVyLCBib2FyZDI6IEJvYXJkKSB7XG4gICAgICAgIGlmICghdGhpcy5hbGxvd1Nob290KSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JykuaW5uZXJIVE1MID0gXCJOaWUgbW/FvGVzeiB0ZXJheiBzdHJ6ZWxhxIdcIjtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ib2FyZFt5XVt4XSA9PT0gU3RhdGUuVGFrZW4pIHtcbiAgICAgICAgICAgIHRoaXMuYm9hcmRbeV1beF0gPSBTdGF0ZS5IaXQ7XG4gICAgICAgICAgICB0aGlzLmh0bWxCb2FyZFt5XVt4XS5jbGFzc0xpc3QuYWRkKCdoaXQnKTtcbiAgICAgICAgICAgIHRoaXMuYWxsb3dTaG9vdCA9IGZhbHNlO1xuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NleGktdGV4dCcpLmlubmVySFRNTCA9IFwiVHJhZmlvbnkhPGJyPlJ1Y2gga29tcHV0ZXJhXCI7XG4gICAgICAgICAgICBib2FyZDIucmFuZG9tU2hvb3QodGhpcykudGhlbihyZXM9PntcbiAgICAgICAgICAgICAgICB0aGlzLmFsbG93U2hvb3QgPSB0cnVlXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NleGktdGV4dCcpLmlubmVySFRNTCA9IFwiVHfDs2ogcnVjaFwiO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYm9hcmRbeV1beF0gPT09IFN0YXRlLkVtcHR5KSB7XG4gICAgICAgICAgICB0aGlzLmJvYXJkW3ldW3hdID0gU3RhdGUuTWlzcztcbiAgICAgICAgICAgIHRoaXMuaHRtbEJvYXJkW3ldW3hdLmNsYXNzTGlzdC5hZGQoJ21pc3MnKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXhpLXRleHQnKS5pbm5lckhUTUwgPSBcIlB1ZMWCbzxicj5SdWNoIGtvbXB1dGVyYVwiO1xuICAgICAgICAgICAgdGhpcy5hbGxvd1Nob290ID0gZmFsc2U7XG4gICAgICAgICAgICBib2FyZDIucmFuZG9tU2hvb3QodGhpcykudGhlbihyZXM9PntcbiAgICAgICAgICAgICAgICB0aGlzLmFsbG93U2hvb3QgPSB0cnVlXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NleGktdGV4dCcpLmlubmVySFRNTCA9IFwiVHfDs2ogcnVjaFwiO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYm9hcmRbeV1beF0gPT09IFN0YXRlLk1pc3MgfHwgdGhpcy5ib2FyZFt5XVt4XSA9PT0gU3RhdGUuSGl0KSB7XG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JykuaW5uZXJIVE1MID0gXCJKdcW8IHRhbSBzdHJ6ZWxpxYJlxZtcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByYW5kb21TaG9vdChib2FyZDI6IEJvYXJkKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PntcbiAgICAgICAgICAgIGNvbnN0IFt5LHhdID0gdGhpcy5zaG90c1tNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqIHRoaXMuc2hvdHMubGVuZ3RoKV07XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLmh0bWxCb2FyZFt5XVt4XSk7XG4gICAgICAgICAgICBpZih0aGlzLmJvYXJkW3ldW3hdID09PSBTdGF0ZS5IaXQpe1xuICAgICAgICAgICAgICAgIHRoaXMuaHRtbEJvYXJkW3ldW3hdLmNsYXNzTGlzdC5hZGQoJ3JlZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICB0aGlzLmh0bWxCb2FyZFt5XVt4XS5jbGFzc0xpc3QuYWRkKCdncmVlbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlQ2hlY2tQb3NpdGlvbnMoc2hpcDogc2hpcFNldHRpbmcsIHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyKTogbnVtYmVyW11bXVtdIHtcbiAgICBjb25zdCB7IHgsIHksIHNpemUsIGRpcmVjdGlvbiB9ID0gc2hpcDtcbiAgICBjb25zdCBwb3NpdGlvbnM6IG51bWJlcltdW10gPSBbXVxuICAgIGZvciAobGV0IGkgPSAtMTsgaSA8IDI7IGkrKykge1xuICAgICAgICBpZiAoIWRpcmVjdGlvbikge1xuICAgICAgICAgICAgZm9yIChsZXQgaiA9IC0xOyBqIDwgc2l6ZSArIDE7IGorKykge1xuICAgICAgICAgICAgICAgIHBvc2l0aW9ucy5wdXNoKFt4ICsgaiwgeSArIGldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAtMTsgaiA8IHNpemUgKyAxOyBqKyspIHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbnMucHVzaChbeCArIGksIHkgKyBqXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3Qgc2hpcFBvcyA9IHBvc2l0aW9ucy5zcGxpY2Uoc2l6ZSArIDMsIHNpemUpO1xuICAgIHJldHVybiBbc2hpcFBvcywgcG9zaXRpb25zLmZpbHRlcihwb3MgPT4ge1xuICAgICAgICByZXR1cm4gKHBvc1swXSA+PSAwICYmIHBvc1swXSA8IHdpZHRoKSAmJiAocG9zWzFdID49IDAgJiYgcG9zWzFdIDwgaGVpZ2h0KVxuICAgIH0pXTtcbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNoaXBTZXR0ZXJ7XG4gICAgc2hpcHM6IG51bWJlcltdO1xuICAgIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQ7XG4gICAgc2VsZWN0ZWQ6IG51bWJlcjtcbiAgICBkaXJlY3Rpb246IGJvb2xlYW47XG4gICAgcGxhY2VkOiBudW1iZXIgPSAwO1xuICAgIGNvbnN0cnVjdG9yKHNoaXBzOiBudW1iZXJbXSl7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5zaGlwcyA9IHNoaXBzLnNsaWNlKCk7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzaGlwc1wiKTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IE1hdGgubWF4KC4uLnNoaXBzKTsgICAgICAgIFxuICAgICAgICBmb3IgKGxldCBpID0gc2hpcHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgc2hpcC5pZCA9IGAke3NoaXBzW2ldfWA7XG4gICAgICAgICAgICBzaGlwLmNsYXNzTmFtZSA9IFwic2hpcFwiO1xuICAgICAgICAgICAgc2hpcC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJzZWxlY3RlZFwiKVswXTtcbiAgICAgICAgICAgICAgICBpZihhKSBhLmNsYXNzTGlzdC5yZW1vdmUoXCJzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBlbCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudDtcbiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBwYXJzZUludChlbC5pZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2hpcHNbaV07IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgICAgIHNoaXAuYXBwZW5kQ2hpbGQoY2VsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZChzaGlwKTtcbiAgICAgICAgfVxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzaGlwJylbMF0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xuICAgICAgICBcbiAgICB9XG4gICAgZ2V0Q29udGFpbmVyID0gKCkgPT4gdGhpcy5jb250YWluZXI7XG4gICAgdXBkYXRlRGlyZWN0aW9uID0gKCkgPT4gdGhpcy5kaXJlY3Rpb24gPSAhdGhpcy5kaXJlY3Rpb247XG4gICAgaXNTZXR0aW5nID0gKCkgPT4gdGhpcy5zZWxlY3RlZCAhPSBudWxsO1xuICAgIHNoaXBQbGFjZWQoKXtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZShcInNlbGVjdGVkXCIpWzBdLnJlbW92ZSgpO1xuICAgICAgICB0aGlzLnNlbGVjdGVkID0gbnVsbDtcbiAgICAgICAgdGhpcy5wbGFjZWQrK1xuICAgICAgICBpZih0aGlzLnBsYWNlZCA9PT0gdGhpcy5zaGlwcy5sZW5ndGgpe1xuICAgICAgICAgICAgY29uc3Qgc3RhcnRCdXR0b24gPSA8SFRNTEJ1dHRvbkVsZW1lbnQ+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGFydCcpO1xuICAgICAgICAgICAgc3RhcnRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaGlwcycpLnJlbW92ZSgpO1xuICAgICAgICAgICAgY29uc3Qgc2V4aSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXhpLXRleHQnKcKgYXMgSFRNTEVsZW1lbnQ7XG4gICAgICAgICAgICBzZXhpLmlubmVySFRNTCA9IFwiUm96cG9jem5paiBncsSZXCI7XG4gICAgICAgIH1cbiAgICB9XG59IiwiaW1wb3J0IHsgY29uZmlnIH0gZnJvbSBcIi4vLi4vY29uZmlnXCI7XG5pbXBvcnQgQm9hcmQgZnJvbSBcIi4vQm9hcmRcIjtcbmltcG9ydCBTaGlwU2V0dGVyIGZyb20gJy4vU2hpcFNldHRlcic7XG5cbmNvbnN0IHsgYm9hcmQsIHNoaXBzU2l6ZXMgfSA9IGNvbmZpZztcblxuY29uc3QgbWFjaGluZUJvYXJkOiBCb2FyZCA9IG5ldyBCb2FyZChib2FyZFswXSwgYm9hcmRbMV0pO1xuY29uc3QgcGxheWVyQm9hcmQ6IEJvYXJkID0gbmV3IEJvYXJkKGJvYXJkWzBdLCBib2FyZFsxXSk7XG5jb25zdCBzaGlwU2V0dGVyID0gbmV3IFNoaXBTZXR0ZXIoc2hpcHNTaXplcyk7XG5cbm1hY2hpbmVCb2FyZC5jcmVhdGVIVE1MQm9hcmQobnVsbCwgcGxheWVyQm9hcmQpO1xucGxheWVyQm9hcmQuY3JlYXRlSFRNTEJvYXJkKHNoaXBTZXR0ZXIpO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm1hY2hpbmVcIikuYXBwZW5kQ2hpbGQobWFjaGluZUJvYXJkLmdldEhNVExCb2FyZCgpKTtcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyXCIpLmFwcGVuZENoaWxkKHBsYXllckJvYXJkLmdldEhNVExCb2FyZCgpKTtcblxubWFjaGluZUJvYXJkLmRyYXdTaGlwcyhzaGlwc1NpemVzLnNsaWNlKCkpO1xuXG5kb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBlID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKHNoaXBTZXR0ZXIuaXNTZXR0aW5nKCkpIHtcbiAgICAgICAgc2hpcFNldHRlci51cGRhdGVEaXJlY3Rpb24oKTtcbiAgICAgICAgcGxheWVyQm9hcmQudXBkYXRlTGFzdFNoaXAoc2hpcFNldHRlci5kaXJlY3Rpb24pO1xuICAgIH1cbn0pO1xuY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQnKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcbnN0YXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JykuaW5uZXJIVE1MID0gXCJUd8OzaiBydWNoXCI7XG4gICAgbWFjaGluZUJvYXJkLmFsbG93U2hvb3QgPSB0cnVlO1xufSk7Il19
