(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.config = {
    board: [10, 10],
    shipsSizes: [1, 1, 1, 1, 2, 2, 2, 3, 3, 4]
};
},{}],2:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var State;
(function (State) {
    State[State["Empty"] = 0] = "Empty";
    State[State["Taken"] = 1] = "Taken";
    State[State["Hit"] = 2] = "Hit";
    State[State["Miss"] = 3] = "Miss";
})(State || (State = {}));
;
var Win;
(function (Win) {
    Win[Win["Player"] = 0] = "Player";
    Win[Win["Machine"] = 1] = "Machine";
})(Win = exports.Win || (exports.Win = {}));
class Board {
    constructor(width, height, endGame = null) {
        this.board = [];
        this.shots = [];
        this.htmlBoard = [];
        this.ships = [];
        this.lastProposed = null;
        this.allowShoot = false;
        this.hits = 0;
        this.gameFinished = false;
        this.endGame = endGame;
        [this.width, this.height] = [width, height];
        for (let i = 0; i < height; i++) {
            const row = [];
            for (let j = 0; j < width; j++) {
                row.push(State.Empty);
                this.shots.push([i, j]);
            }
            this.board.push(row);
        }
    }
    createHTMLBoard(shipSetter = null, board2 = null) {
        this.boardContainer = document.createElement("div");
        this.boardContainer.className = "board";
        for (let i = 0; i < this.height; i++) {
            const row = [];
            const rowDiv = document.createElement('div');
            rowDiv.className = "row";
            for (let j = 0; j < this.width; j++) {
                const cell = document.createElement("div");
                if (shipSetter) {
                    this.toHit = shipSetter.ships.reduce((a, b) => a + b);
                    cell.addEventListener('mouseover', (e) => this.checkShip(e, shipSetter, true));
                    cell.addEventListener('click', (e) => this.checkAndAddShip(e, shipSetter));
                }
                else {
                    cell.addEventListener('click', (e) => this.shoot(i, j, board2));
                }
                cell.className = "cell";
                cell.id = `${j}-${i}`;
                row.push(cell);
                rowDiv.appendChild(cell);
            }
            this.htmlBoard.push(row);
            this.boardContainer.appendChild(rowDiv);
        }
    }
    getHMTLBoard() { return this.boardContainer; }
    addShip(x, y, length, direction, show = false) {
        for (let i = 0; i < length; i++) {
            let [X, Y] = [x, y];
            if (direction)
                Y = y + i;
            else
                X = x + i;
            this.board[Y][X] = State.Taken;
            if (show) {
                this.htmlBoard[Y][X].classList.add('blue');
            }
        }
    }
    drawShips(shipSizes) {
        this.toHit = shipSizes.reduce((a, b) => a + b);
        while (shipSizes.length > 0) {
            const size = shipSizes.pop();
            let found = false;
            while (!found) {
                let [x, y, direction] = [Math.floor(Math.random() * this.width), Math.floor(Math.random() * this.height), Math.random() < 0.5];
                if (x > this.width - size && !direction) {
                    continue;
                }
                if (y > this.height - size && direction) {
                    continue;
                }
                if (size === 4) {
                    this.addShip(x, y, size, direction);
                    break;
                }
                const s = {
                    x,
                    y,
                    direction,
                    size
                };
                const [shipsPos, surroundings] = generateCheckPositions(s, this.width, this.height);
                found = this.checkPositions(shipsPos, surroundings);
                if (found)
                    this.addShip(x, y, size, direction);
            }
        }
        console.table(this.board);
    }
    checkPositions(ships, surroundings) {
        const s = ships.filter(pos => {
            return this.board[pos[1]][pos[0]] === State.Empty;
        });
        const sur = surroundings.filter(pos => {
            return this.board[pos[1]][pos[0]] === State.Empty;
        });
        return (ships.length === s.length && surroundings.length === sur.length);
    }
    viewShip(color, s) {
        const { x, y, direction, size } = s;
        for (let i = 0; i < size; i++) {
            let [X, Y] = [x, y];
            if (direction)
                Y = y + i;
            else
                X = x + i;
            if (X >= 0 && X < this.width && Y >= 0 && Y < this.height) {
                this.htmlBoard[Y][X].style.backgroundColor = color;
            }
        }
        this.lastProposed = s;
    }
    checkShip(e, shipSetter, view) {
        if (!shipSetter.selected)
            return false;
        const el = e.target;
        const pos = el.id.split("-").map(a => parseInt(a));
        const ship = {
            x: pos[0],
            y: pos[1],
            direction: shipSetter.direction,
            size: shipSetter.selected
        };
        if (ship.x + ship.size > this.width && !ship.direction) {
            ship.x = this.width - ship.size;
        }
        if (ship.y + ship.size > this.height && ship.direction) {
            ship.y = this.width - ship.size;
        }
        const [shipsPos, surroundings] = generateCheckPositions(ship, this.width, this.height);
        const shipValid = this.checkPositions(shipsPos, surroundings);
        if (view) {
            if (this.lastProposed) {
                this.viewShip("", this.lastProposed);
            }
            this.viewShip(shipValid ? "green" : "red", ship);
        }
        return shipValid;
    }
    updateLastShip(dir) {
        if (!this.lastProposed)
            return;
        const s = Object.assign({}, this.lastProposed);
        s.direction = dir;
        this.viewShip("", this.lastProposed);
        this.viewShip("green", s);
    }
    checkAndAddShip(e, shipS) {
        if (this.checkShip(e, shipS, false)) {
            this.viewShip("", this.lastProposed);
            const { x, y, direction, size } = this.lastProposed;
            this.addShip(x, y, size, direction, true);
            shipS.shipPlaced();
        }
    }
    shoot(y, x, board2) {
        if (this.gameFinished)
            return;
        if (!this.allowShoot) {
            document.getElementById('sexi-text').innerHTML = "Nie możesz teraz strzelać";
            return;
        }
        if (this.board[y][x] === State.Miss || this.board[y][x] === State.Hit) {
            document.getElementById('sexi-text').innerHTML = "Już tam strzeliłeś";
            return;
        }
        const hit = this.board[y][x] === State.Taken;
        this.board[y][x] = hit ? State.Hit : State.Miss;
        this.htmlBoard[y][x].classList.add(hit ? 'hit' : 'miss');
        document.getElementById('sexi-text').innerHTML = hit ? "Trafiony!<br>Ruch komputera" : "Pudło<br>Ruch komputera";
        this.allowShoot = false;
        if (hit)
            this.hits++;
        if (this.hits === this.toHit) {
            this.endGame(Win.Player);
            this.gameFinished = true;
            return;
        }
        board2.randomShoot().then(([y, x, hit]) => {
            board2.htmlBoard[y][x].classList.add(hit ? 'hit' : 'miss');
            this.allowShoot = true;
            document.getElementById('sexi-text').innerHTML = "Twój ruch";
            if (board2.hits === board2.toHit) {
                this.endGame(Win.Machine);
                this.gameFinished = true;
            }
        });
    }
    randomShoot() {
        return new Promise((resolve, reject) => {
            const r = Math.floor(Math.random() * this.shots.length);
            const [y, x] = this.shots[r];
            const hit = this.board[y][x] === State.Taken;
            this.shots.splice(r, 1);
            if (hit)
                this.hits++;
            setTimeout(() => { resolve([y, x, hit]); }, 1000);
        });
    }
}
exports.default = Board;
function generateCheckPositions(ship, width, height) {
    const { x, y, size, direction } = ship;
    const positions = [];
    for (let i = -1; i < 2; i++) {
        if (!direction) {
            for (let j = -1; j < size + 1; j++) {
                positions.push([x + j, y + i]);
            }
        }
        else {
            for (let j = -1; j < size + 1; j++) {
                positions.push([x + i, y + j]);
            }
        }
    }
    const shipPos = positions.splice(size + 3, size);
    return [shipPos, positions.filter(pos => {
            return (pos[0] >= 0 && pos[0] < width) && (pos[1] >= 0 && pos[1] < height);
        })];
}
},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class ShipSetter {
    constructor(ships) {
        this.placed = 0;
        this.getContainer = () => this.container;
        this.updateDirection = () => this.direction = !this.direction;
        this.isSetting = () => this.selected != null;
        this.direction = true;
        this.ships = ships.slice();
        this.container = document.getElementById("ships");
        this.selected = Math.max(...ships);
        for (let i = ships.length - 1; i >= 0; i--) {
            const ship = document.createElement("div");
            ship.id = `${ships[i]}`;
            ship.className = "ship";
            ship.addEventListener("click", e => {
                const a = document.getElementsByClassName("selected")[0];
                if (a)
                    a.classList.remove("selected");
                const el = e.currentTarget;
                el.classList.add('selected');
                this.selected = parseInt(el.id);
            });
            for (let j = 0; j < ships[i]; j++) {
                const cell = document.createElement("div");
                ship.appendChild(cell);
            }
            this.container.appendChild(ship);
        }
        document.getElementsByClassName('ship')[0].classList.add("selected");
    }
    shipPlaced() {
        document.getElementsByClassName("selected")[0].remove();
        this.selected = null;
        this.placed++;
        if (this.placed === this.ships.length) {
            const startButton = document.getElementById('start');
            startButton.disabled = false;
            document.getElementById('ships').remove();
            const sexi = document.getElementById('sexi-text');
            sexi.innerHTML = "Rozpocznij grę";
        }
    }
}
exports.default = ShipSetter;
},{}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const config_1 = require("./../config");
const Board_1 = require("./Board");
const ShipSetter_1 = require("./ShipSetter");
function endGame(who) {
    if (who === Board_1.Win.Player) {
        document.getElementById('sexi-text').innerHTML = "Wygrałeś!";
    }
    else {
        document.getElementById('sexi-text').innerHTML = "Przegrałeś!";
    }
}
const { board, shipsSizes } = config_1.config;
const machineBoard = new Board_1.default(board[0], board[1], endGame);
const playerBoard = new Board_1.default(board[0], board[1], endGame);
const shipSetter = new ShipSetter_1.default(shipsSizes);
machineBoard.createHTMLBoard(null, playerBoard);
playerBoard.createHTMLBoard(shipSetter);
document.getElementById("machine").appendChild(machineBoard.getHMTLBoard());
document.getElementById("player").appendChild(playerBoard.getHMTLBoard());
machineBoard.drawShips(shipsSizes.slice());
document.body.addEventListener("contextmenu", e => {
    e.preventDefault();
    if (shipSetter.isSetting()) {
        shipSetter.updateDirection();
        playerBoard.updateLastShip(shipSetter.direction);
    }
});
const startButton = document.getElementById('start');
startButton.disabled = true;
startButton.addEventListener('click', (e) => {
    document.getElementById('sexi-text').innerHTML = "Twój ruch";
    machineBoard.allowShoot = true;
    startButton.remove();
});
},{"./../config":1,"./Board":2,"./ShipSetter":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29uZmlnLnRzIiwic3JjL3RzL0JvYXJkLnRzIiwic3JjL3RzL1NoaXBTZXR0ZXIudHMiLCJzcmMvdHMvbWFpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDS2EsUUFBQSxNQUFNLEdBQVc7SUFDMUIsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUNmLFVBQVUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztDQUM3QyxDQUFBOzs7O0FDRUQsSUFBSyxLQUtKO0FBTEQsV0FBSyxLQUFLO0lBQ04sbUNBQUssQ0FBQTtJQUNMLG1DQUFLLENBQUE7SUFDTCwrQkFBRyxDQUFBO0lBQ0gsaUNBQUksQ0FBQTtBQUNSLENBQUMsRUFMSSxLQUFLLEtBQUwsS0FBSyxRQUtUO0FBQUEsQ0FBQztBQUNGLElBQVksR0FHWDtBQUhELFdBQVksR0FBRztJQUNYLGlDQUFNLENBQUE7SUFDTixtQ0FBTyxDQUFBO0FBQ1gsQ0FBQyxFQUhXLEdBQUcsR0FBSCxXQUFHLEtBQUgsV0FBRyxRQUdkO0FBRUQsTUFBcUIsS0FBSztJQWN0QixZQUFZLEtBQWEsRUFBRSxNQUFjLEVBQUUsVUFBbUIsSUFBSTtRQWJsRSxVQUFLLEdBQWUsRUFBRSxDQUFDO1FBQ3ZCLFVBQUssR0FBZSxFQUFFLENBQUE7UUFHdEIsY0FBUyxHQUFvQixFQUFFLENBQUM7UUFFaEMsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUNuQixpQkFBWSxHQUFnQixJQUFJLENBQUM7UUFDakMsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUU1QixTQUFJLEdBQVcsQ0FBQyxDQUFDO1FBRWpCLGlCQUFZLEdBQVksS0FBSyxDQUFDO1FBRTFCLElBQUksQ0FBQyxPQUFP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QVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztLQUNwRDtBQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0gsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQXNCLENBQUM7QUFDMUUsV0FBVyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7QUFDNUIsV0FBVyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFO0lBQ3hDLFFBQVEsQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQztJQUM3RCxZQUFZLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztJQUMvQixXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpbnRlcmZhY2UgQ29uZmlnIHtcbiAgICBib2FyZDogbnVtYmVyW107XG4gICAgc2hpcHNTaXplczogbnVtYmVyW11cbn1cblxuZXhwb3J0IGNvbnN0IGNvbmZpZzogQ29uZmlnID0ge1xuICAgIGJvYXJkOiBbMTAsIDEwXSxcbiAgICBzaGlwc1NpemVzOiBbMSwgMSwgMSwgMSwgMiwgMiwgMiwgMywgMywgNF1cbn1cblxuIiwiaW1wb3J0IFNoaXAgZnJvbSAnLi9TaGlwJztcclxuaW1wb3J0IFNoaXBTZXR0ZXIgZnJvbSAnLi9TaGlwU2V0dGVyJztcclxuXHJcbmludGVyZmFjZSBzaGlwU2V0dGluZyB7XHJcbiAgICB4OiBudW1iZXI7XHJcbiAgICB5OiBudW1iZXI7XHJcbiAgICBkaXJlY3Rpb246IGJvb2xlYW47XHJcbiAgICBzaXplOiBudW1iZXI7XHJcbn1cclxuXHJcbmVudW0gU3RhdGUge1xyXG4gICAgRW1wdHksXHJcbiAgICBUYWtlbixcclxuICAgIEhpdCxcclxuICAgIE1pc3NcclxufTtcclxuZXhwb3J0IGVudW0gV2lue1xyXG4gICAgUGxheWVyLFxyXG4gICAgTWFjaGluZVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCb2FyZCB7XHJcbiAgICBib2FyZDogbnVtYmVyW11bXSA9IFtdO1xyXG4gICAgc2hvdHM6IG51bWJlcltdW10gPSBbXVxyXG4gICAgd2lkdGg6IG51bWJlcjtcclxuICAgIGhlaWdodDogbnVtYmVyO1xyXG4gICAgaHRtbEJvYXJkOiBIVE1MRWxlbWVudFtdW10gPSBbXTtcclxuICAgIGJvYXJkQ29udGFpbmVyOiBIVE1MRWxlbWVudDtcclxuICAgIHNoaXBzOiBTaGlwW10gPSBbXTtcclxuICAgIGxhc3RQcm9wb3NlZDogc2hpcFNldHRpbmcgPSBudWxsO1xyXG4gICAgYWxsb3dTaG9vdDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgdG9IaXQ6IG51bWJlcjtcclxuICAgIGhpdHM6IG51bWJlciA9IDA7XHJcbiAgICBlbmRHYW1lOiBGdW5jdGlvbjtcclxuICAgIGdhbWVGaW5pc2hlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgY29uc3RydWN0b3Iod2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIsIGVuZEdhbWU6RnVuY3Rpb24gPSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5lbmRHYW1lID0gZW5kR2FtZTtcclxuICAgICAgICBbdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdID0gW3dpZHRoLCBoZWlnaHRdO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3Qgcm93OiBudW1iZXJbXSA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIHJvdy5wdXNoKFN0YXRlLkVtcHR5KTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvdHMucHVzaChbaSwgal0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmQucHVzaChyb3cpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY3JlYXRlSFRNTEJvYXJkKHNoaXBTZXR0ZXI6IFNoaXBTZXR0ZXIgPSBudWxsLCBib2FyZDI6IEJvYXJkID0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuYm9hcmRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXHJcbiAgICAgICAgdGhpcy5ib2FyZENvbnRhaW5lci5jbGFzc05hbWUgPSBcImJvYXJkXCI7ICAgICAgICBcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuaGVpZ2h0OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3Qgcm93OiBIVE1MRWxlbWVudFtdID0gW107XHJcbiAgICAgICAgICAgIGNvbnN0IHJvd0RpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICByb3dEaXYuY2xhc3NOYW1lID0gXCJyb3dcIjtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLndpZHRoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNoaXBTZXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnRvSGl0ID0gc2hpcFNldHRlci5zaGlwcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlb3ZlcicsIChlKSA9PiB0aGlzLmNoZWNrU2hpcChlLCBzaGlwU2V0dGVyLCB0cnVlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB0aGlzLmNoZWNrQW5kQWRkU2hpcChlLCBzaGlwU2V0dGVyKSk7XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB0aGlzLnNob290KGksIGosIGJvYXJkMikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTmFtZSA9IFwiY2VsbFwiO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5pZCA9IGAke2p9LSR7aX1gO1xyXG4gICAgICAgICAgICAgICAgcm93LnB1c2goY2VsbCk7XHJcbiAgICAgICAgICAgICAgICByb3dEaXYuYXBwZW5kQ2hpbGQoY2VsbCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaHRtbEJvYXJkLnB1c2gocm93KVxyXG4gICAgICAgICAgICB0aGlzLmJvYXJkQ29udGFpbmVyLmFwcGVuZENoaWxkKHJvd0Rpdik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0SE1UTEJvYXJkKCkgeyByZXR1cm4gdGhpcy5ib2FyZENvbnRhaW5lciB9XHJcbiAgICBhZGRTaGlwKHg6IG51bWJlciwgeTogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgZGlyZWN0aW9uOiBib29sZWFuLCBzaG93OiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBbWCwgWV0gPSBbeCwgeV07XHJcbiAgICAgICAgICAgIGlmIChkaXJlY3Rpb24pIFkgPSB5ICsgaTtcclxuICAgICAgICAgICAgZWxzZSBYID0geCArIGk7XHJcbiAgICAgICAgICAgIHRoaXMuYm9hcmRbWV1bWF0gPSBTdGF0ZS5UYWtlbjtcclxuICAgICAgICAgICAgaWYgKHNob3cpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaHRtbEJvYXJkW1ldW1hdLmNsYXNzTGlzdC5hZGQoJ2JsdWUnKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGRyYXdTaGlwcyhzaGlwU2l6ZXM6IG51bWJlcltdKSB7XHJcbiAgICAgICAgdGhpcy50b0hpdCA9IHNoaXBTaXplcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiKTtcclxuICAgICAgICB3aGlsZSAoc2hpcFNpemVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IHNoaXBTaXplcy5wb3AoKTtcclxuICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHdoaWxlICghZm91bmQpIHtcclxuICAgICAgICAgICAgICAgIGxldCBbeCwgeSwgZGlyZWN0aW9uXSA9IFtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLndpZHRoKSwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5oZWlnaHQpLCBNYXRoLnJhbmRvbSgpIDwgMC41XTtcclxuICAgICAgICAgICAgICAgIGlmICh4ID4gdGhpcy53aWR0aCAtIHNpemUgJiYgIWRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHkgPiB0aGlzLmhlaWdodCAtIHNpemUgJiYgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoc2l6ZSA9PT0gNCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZFNoaXAoeCwgeSwgc2l6ZSwgZGlyZWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3Qgczogc2hpcFNldHRpbmcgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeCxcclxuICAgICAgICAgICAgICAgICAgICB5LFxyXG4gICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbixcclxuICAgICAgICAgICAgICAgICAgICBzaXplXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBbc2hpcHNQb3MsIHN1cnJvdW5kaW5nc10gPSBnZW5lcmF0ZUNoZWNrUG9zaXRpb25zKHMsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgICAgIGZvdW5kID0gdGhpcy5jaGVja1Bvc2l0aW9ucyhzaGlwc1Bvcywgc3Vycm91bmRpbmdzKVxyXG4gICAgICAgICAgICAgICAgaWYgKGZvdW5kKSB0aGlzLmFkZFNoaXAoeCwgeSwgc2l6ZSwgZGlyZWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLnRhYmxlKHRoaXMuYm9hcmQpO1xyXG4gICAgfVxyXG4gICAgY2hlY2tQb3NpdGlvbnMoc2hpcHM6IG51bWJlcltdW10sIHN1cnJvdW5kaW5nczogbnVtYmVyW11bXSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IHMgPSBzaGlwcy5maWx0ZXIocG9zID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm9hcmRbcG9zWzFdXVtwb3NbMF1dID09PSBTdGF0ZS5FbXB0eVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgY29uc3Qgc3VyID0gc3Vycm91bmRpbmdzLmZpbHRlcihwb3MgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ib2FyZFtwb3NbMV1dW3Bvc1swXV0gPT09IFN0YXRlLkVtcHR5XHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gKHNoaXBzLmxlbmd0aCA9PT0gcy5sZW5ndGggJiYgc3Vycm91bmRpbmdzLmxlbmd0aCA9PT0gc3VyLmxlbmd0aClcclxuICAgIH1cclxuICAgIHZpZXdTaGlwKGNvbG9yOiBzdHJpbmcsIHM6IHNoaXBTZXR0aW5nKSB7XHJcbiAgICAgICAgY29uc3QgeyB4LCB5LCBkaXJlY3Rpb24sIHNpemUgfSA9IHM7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IFtYLCBZXSA9IFt4LCB5XTtcclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbikgWSA9IHkgKyBpO1xyXG4gICAgICAgICAgICBlbHNlIFggPSB4ICsgaTtcclxuICAgICAgICAgICAgaWYgKFggPj0gMCAmJiBYIDwgdGhpcy53aWR0aCAmJiBZID49IDAgJiYgWSA8IHRoaXMuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmh0bWxCb2FyZFtZXVtYXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxhc3RQcm9wb3NlZCA9IHM7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tTaGlwKGU6IEV2ZW50LCBzaGlwU2V0dGVyOiBTaGlwU2V0dGVyLCB2aWV3OiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKCFzaGlwU2V0dGVyLnNlbGVjdGVkKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgY29uc3QgZWwgPSBlLnRhcmdldCBhcyBIVE1MRWxlbWVudDtcclxuICAgICAgICBjb25zdCBwb3MgPSBlbC5pZC5zcGxpdChcIi1cIikubWFwKGEgPT4gcGFyc2VJbnQoYSkpO1xyXG4gICAgICAgIGNvbnN0IHNoaXA6IHNoaXBTZXR0aW5nID0ge1xyXG4gICAgICAgICAgICB4OiBwb3NbMF0sXHJcbiAgICAgICAgICAgIHk6IHBvc1sxXSxcclxuICAgICAgICAgICAgZGlyZWN0aW9uOiBzaGlwU2V0dGVyLmRpcmVjdGlvbixcclxuICAgICAgICAgICAgc2l6ZTogc2hpcFNldHRlci5zZWxlY3RlZFxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2hpcC54ICsgc2hpcC5zaXplID4gdGhpcy53aWR0aCAmJiAhc2hpcC5kaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgc2hpcC54ID0gdGhpcy53aWR0aCAtIHNoaXAuc2l6ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNoaXAueSArIHNoaXAuc2l6ZSA+IHRoaXMuaGVpZ2h0ICYmIHNoaXAuZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHNoaXAueSA9IHRoaXMud2lkdGggLSBzaGlwLnNpemU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IFtzaGlwc1Bvcywgc3Vycm91bmRpbmdzXSA9IGdlbmVyYXRlQ2hlY2tQb3NpdGlvbnMoc2hpcCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xyXG4gICAgICAgIGNvbnN0IHNoaXBWYWxpZCA9IHRoaXMuY2hlY2tQb3NpdGlvbnMoc2hpcHNQb3MsIHN1cnJvdW5kaW5ncyk7XHJcbiAgICAgICAgaWYgKHZpZXcpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMubGFzdFByb3Bvc2VkKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdTaGlwKFwiXCIsIHRoaXMubGFzdFByb3Bvc2VkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnZpZXdTaGlwKHNoaXBWYWxpZCA/IFwiZ3JlZW5cIiA6IFwicmVkXCIsIHNoaXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gc2hpcFZhbGlkO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlTGFzdFNoaXAoZGlyOiBib29sZWFuKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxhc3RQcm9wb3NlZCkgcmV0dXJuO1xyXG4gICAgICAgIGNvbnN0IHMgPSB7IC4uLnRoaXMubGFzdFByb3Bvc2VkIH07XHJcbiAgICAgICAgcy5kaXJlY3Rpb24gPSBkaXI7XHJcbiAgICAgICAgdGhpcy52aWV3U2hpcChcIlwiLCB0aGlzLmxhc3RQcm9wb3NlZCk7XHJcbiAgICAgICAgdGhpcy52aWV3U2hpcChcImdyZWVuXCIsIHMpO1xyXG4gICAgfVxyXG4gICAgY2hlY2tBbmRBZGRTaGlwKGU6IEV2ZW50LCBzaGlwUzogU2hpcFNldHRlcikge1xyXG4gICAgICAgIGlmICh0aGlzLmNoZWNrU2hpcChlLCBzaGlwUywgZmFsc2UpKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld1NoaXAoXCJcIiwgdGhpcy5sYXN0UHJvcG9zZWQpO1xyXG4gICAgICAgICAgICBjb25zdCB7IHgsIHksIGRpcmVjdGlvbiwgc2l6ZSB9ID0gdGhpcy5sYXN0UHJvcG9zZWQ7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkU2hpcCh4LCB5LCBzaXplLCBkaXJlY3Rpb24sIHRydWUpO1xyXG4gICAgICAgICAgICBzaGlwUy5zaGlwUGxhY2VkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2hvb3QoeTogbnVtYmVyLCB4OiBudW1iZXIsIGJvYXJkMjogQm9hcmQpIHtcclxuICAgICAgICBpZih0aGlzLmdhbWVGaW5pc2hlZCkgcmV0dXJuO1xyXG4gICAgICAgIGlmICghdGhpcy5hbGxvd1Nob290KSB7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXhpLXRleHQnKS5pbm5lckhUTUwgPSBcIk5pZSBtb8W8ZXN6IHRlcmF6IHN0cnplbGHEh1wiO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmJvYXJkW3ldW3hdID09PSBTdGF0ZS5NaXNzIHx8IHRoaXMuYm9hcmRbeV1beF0gPT09IFN0YXRlLkhpdCkge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JykuaW5uZXJIVE1MID0gXCJKdcW8IHRhbSBzdHJ6ZWxpxYJlxZtcIjtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBoaXQgPSB0aGlzLmJvYXJkW3ldW3hdID09PSBTdGF0ZS5UYWtlbjtcclxuICAgICAgICB0aGlzLmJvYXJkW3ldW3hdID0gaGl0ID8gU3RhdGUuSGl0IDogU3RhdGUuTWlzcztcclxuICAgICAgICB0aGlzLmh0bWxCb2FyZFt5XVt4XS5jbGFzc0xpc3QuYWRkKGhpdCA/ICdoaXQnIDogJ21pc3MnKTtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JykuaW5uZXJIVE1MID0gaGl0ID8gXCJUcmFmaW9ueSE8YnI+UnVjaCBrb21wdXRlcmFcIiA6IFwiUHVkxYJvPGJyPlJ1Y2gga29tcHV0ZXJhXCI7XHJcbiAgICAgICAgdGhpcy5hbGxvd1Nob290ID0gZmFsc2U7XHJcbiAgICAgICAgaWYoaGl0KSB0aGlzLmhpdHMrKztcclxuICAgICAgICBpZih0aGlzLmhpdHMgPT09IHRoaXMudG9IaXQpe1xyXG4gICAgICAgICAgICB0aGlzLmVuZEdhbWUoV2luLlBsYXllcik7XHJcbiAgICAgICAgICAgIHRoaXMuZ2FtZUZpbmlzaGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBib2FyZDIucmFuZG9tU2hvb3QoKS50aGVuKChbeSwgeCwgaGl0XSkgPT4ge1xyXG4gICAgICAgICAgICBib2FyZDIuaHRtbEJvYXJkW3ldW3hdLmNsYXNzTGlzdC5hZGQoaGl0ID8gJ2hpdCcgOiAnbWlzcycpO1xyXG4gICAgICAgICAgICB0aGlzLmFsbG93U2hvb3QgPSB0cnVlO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JykuaW5uZXJIVE1MID0gXCJUd8OzaiBydWNoXCI7XHJcbiAgICAgICAgICAgIGlmKGJvYXJkMi5oaXRzID09PSBib2FyZDIudG9IaXQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZW5kR2FtZShXaW4uTWFjaGluZSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdhbWVGaW5pc2hlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICByYW5kb21TaG9vdCgpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdGhpcy5zaG90cy5sZW5ndGgpO1xyXG4gICAgICAgICAgICBjb25zdCBbeSwgeF0gPSB0aGlzLnNob3RzW3JdO1xyXG4gICAgICAgICAgICBjb25zdCBoaXQgPSB0aGlzLmJvYXJkW3ldW3hdID09PSBTdGF0ZS5UYWtlbjsgICAgICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5zaG90cy5zcGxpY2UociwgMSk7XHJcbiAgICAgICAgICAgIGlmKGhpdCkgdGhpcy5oaXRzKys7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyByZXNvbHZlKFt5LCB4LCBoaXRdKSB9LCAxMDAwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2VuZXJhdGVDaGVja1Bvc2l0aW9ucyhzaGlwOiBzaGlwU2V0dGluZywgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBudW1iZXJbXVtdW10ge1xyXG4gICAgY29uc3QgeyB4LCB5LCBzaXplLCBkaXJlY3Rpb24gfSA9IHNoaXA7XHJcbiAgICBjb25zdCBwb3NpdGlvbnM6IG51bWJlcltdW10gPSBbXVxyXG4gICAgZm9yIChsZXQgaSA9IC0xOyBpIDwgMjsgaSsrKSB7XHJcbiAgICAgICAgaWYgKCFkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IC0xOyBqIDwgc2l6ZSArIDE7IGorKykge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb25zLnB1c2goW3ggKyBqLCB5ICsgaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaiA9IC0xOyBqIDwgc2l6ZSArIDE7IGorKykge1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb25zLnB1c2goW3ggKyBpLCB5ICsgal0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3Qgc2hpcFBvcyA9IHBvc2l0aW9ucy5zcGxpY2Uoc2l6ZSArIDMsIHNpemUpO1xyXG4gICAgcmV0dXJuIFtzaGlwUG9zLCBwb3NpdGlvbnMuZmlsdGVyKHBvcyA9PiB7XHJcbiAgICAgICAgcmV0dXJuIChwb3NbMF0gPj0gMCAmJiBwb3NbMF0gPCB3aWR0aCkgJiYgKHBvc1sxXSA+PSAwICYmIHBvc1sxXSA8IGhlaWdodClcclxuICAgIH0pXTtcclxufVxyXG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTaGlwU2V0dGVye1xyXG4gICAgc2hpcHM6IG51bWJlcltdO1xyXG4gICAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcclxuICAgIHNlbGVjdGVkOiBudW1iZXI7XHJcbiAgICBkaXJlY3Rpb246IGJvb2xlYW47XHJcbiAgICBwbGFjZWQ6IG51bWJlciA9IDA7XHJcbiAgICBjb25zdHJ1Y3RvcihzaGlwczogbnVtYmVyW10pe1xyXG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnNoaXBzID0gc2hpcHMuc2xpY2UoKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2hpcHNcIik7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IE1hdGgubWF4KC4uLnNoaXBzKTsgICAgICAgIFxyXG4gICAgICAgIGZvciAobGV0IGkgPSBzaGlwcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgc2hpcC5pZCA9IGAke3NoaXBzW2ldfWA7XHJcbiAgICAgICAgICAgIHNoaXAuY2xhc3NOYW1lID0gXCJzaGlwXCI7XHJcbiAgICAgICAgICAgIHNoaXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJzZWxlY3RlZFwiKVswXTtcclxuICAgICAgICAgICAgICAgIGlmKGEpIGEuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZWwgPSBlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHBhcnNlSW50KGVsLmlkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2hpcHNbaV07IGorKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICBzaGlwLmFwcGVuZENoaWxkKGNlbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHNoaXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzaGlwJylbMF0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gICAgZ2V0Q29udGFpbmVyID0gKCkgPT4gdGhpcy5jb250YWluZXI7XHJcbiAgICB1cGRhdGVEaXJlY3Rpb24gPSAoKSA9PiB0aGlzLmRpcmVjdGlvbiA9ICF0aGlzLmRpcmVjdGlvbjtcclxuICAgIGlzU2V0dGluZyA9ICgpID0+IHRoaXMuc2VsZWN0ZWQgIT0gbnVsbDtcclxuICAgIHNoaXBQbGFjZWQoKXtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwic2VsZWN0ZWRcIilbMF0ucmVtb3ZlKCk7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wbGFjZWQrK1xyXG4gICAgICAgIGlmKHRoaXMucGxhY2VkID09PSB0aGlzLnNoaXBzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0QnV0dG9uID0gPEhUTUxCdXR0b25FbGVtZW50PiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhcnQnKTtcclxuICAgICAgICAgICAgc3RhcnRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NoaXBzJykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHNleGkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JynCoGFzIEhUTUxFbGVtZW50O1xyXG4gICAgICAgICAgICBzZXhpLmlubmVySFRNTCA9IFwiUm96cG9jem5paiBncsSZXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgY29uZmlnIH0gZnJvbSBcIi4vLi4vY29uZmlnXCI7XHJcbmltcG9ydCBCb2FyZCwge1dpbn0gZnJvbSBcIi4vQm9hcmRcIjtcclxuaW1wb3J0IFNoaXBTZXR0ZXIgZnJvbSAnLi9TaGlwU2V0dGVyJztcclxuXHJcbmZ1bmN0aW9uIGVuZEdhbWUod2hvOiBudW1iZXIpe1xyXG4gICAgaWYod2hvID09PSBXaW4uUGxheWVyKXtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2V4aS10ZXh0JykuaW5uZXJIVE1MID0gXCJXeWdyYcWCZcWbIVwiO1xyXG4gICAgfWVsc2V7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NleGktdGV4dCcpLmlubmVySFRNTCA9IFwiUHJ6ZWdyYcWCZcWbIVwiO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCB7IGJvYXJkLCBzaGlwc1NpemVzIH0gPSBjb25maWc7XHJcblxyXG5jb25zdCBtYWNoaW5lQm9hcmQ6IEJvYXJkID0gbmV3IEJvYXJkKGJvYXJkWzBdLCBib2FyZFsxXSwgZW5kR2FtZSk7XHJcbmNvbnN0IHBsYXllckJvYXJkOiBCb2FyZCA9IG5ldyBCb2FyZChib2FyZFswXSwgYm9hcmRbMV0sIGVuZEdhbWUpO1xyXG5jb25zdCBzaGlwU2V0dGVyID0gbmV3IFNoaXBTZXR0ZXIoc2hpcHNTaXplcyk7XHJcblxyXG5tYWNoaW5lQm9hcmQuY3JlYXRlSFRNTEJvYXJkKG51bGwsIHBsYXllckJvYXJkKTtcclxucGxheWVyQm9hcmQuY3JlYXRlSFRNTEJvYXJkKHNoaXBTZXR0ZXIpO1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtYWNoaW5lXCIpLmFwcGVuZENoaWxkKG1hY2hpbmVCb2FyZC5nZXRITVRMQm9hcmQoKSk7XHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicGxheWVyXCIpLmFwcGVuZENoaWxkKHBsYXllckJvYXJkLmdldEhNVExCb2FyZCgpKTtcclxuXHJcbm1hY2hpbmVCb2FyZC5kcmF3U2hpcHMoc2hpcHNTaXplcy5zbGljZSgpKTtcclxuXHJcbmRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcihcImNvbnRleHRtZW51XCIsIGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgaWYgKHNoaXBTZXR0ZXIuaXNTZXR0aW5nKCkpIHtcclxuICAgICAgICBzaGlwU2V0dGVyLnVwZGF0ZURpcmVjdGlvbigpO1xyXG4gICAgICAgIHBsYXllckJvYXJkLnVwZGF0ZUxhc3RTaGlwKHNoaXBTZXR0ZXIuZGlyZWN0aW9uKTtcclxuICAgIH1cclxufSk7XHJcbmNvbnN0IHN0YXJ0QnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0JykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbnN0YXJ0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuc3RhcnRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4geyAgICBcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZXhpLXRleHQnKS5pbm5lckhUTUwgPSBcIlR3w7NqIHJ1Y2hcIjtcclxuICAgIG1hY2hpbmVCb2FyZC5hbGxvd1Nob290ID0gdHJ1ZTtcclxuICAgIHN0YXJ0QnV0dG9uLnJlbW92ZSgpO1xyXG59KTtcclxuXHJcblxyXG4iXX0=
