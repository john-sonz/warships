(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.config = {
    board: [10, 10],
    shipsSizes: [1, 1, 1, 1, 2, 2, 2, 3, 3, 4]
};
},{}],2:[function(require,module,exports){
"use strict";
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", { value: true });
var colors = ["blue", "red", "green", "yellow"];
var Board = /** @class */ (function () {
    function Board(width, height) {
        var _a;
        this.board = [];
        this.htmlBoard = [];
        this.ships = [];
        this.lastProposed = null;
        _a = [width, height], this.width = _a[0], this.height = _a[1];
        for (var i = 0; i < height; i++) {
            var row = [];
            for (var j = 0; j < width; j++) {
                row.push(0);
            }
            this.board.push(row);
        }
    }
    Board.prototype.createHTMLBoard = function (shipSetter) {
        var _this = this;
        if (shipSetter === void 0) { shipSetter = null; }
        this.boardContainer = document.createElement("div");
        this.boardContainer.className = "board";
        for (var i = 0; i < this.height; i++) {
            var row = [];
            var rowDiv = document.createElement('div');
            rowDiv.className = "row";
            for (var j = 0; j < this.width; j++) {
                var cell = document.createElement("div");
                if (shipSetter) {
                    cell.addEventListener('mouseover', function (e) { return _this.checkShip(e, shipSetter, true); });
                    cell.addEventListener('click', function (e) { return _this.checkAndAddShip(e, shipSetter); });
                }
                cell.className = "cell";
                cell.id = j + "-" + i;
                row.push(cell);
                rowDiv.appendChild(cell);
            }
            this.htmlBoard.push(row);
            this.boardContainer.appendChild(rowDiv);
        }
    };
    Board.prototype.getHMTLBoard = function () { return this.boardContainer; };
    Board.prototype.addShip = function (x, y, length, direction, show) {
        if (show === void 0) { show = false; }
        for (var i = 0; i < length; i++) {
            var _a = [x, y], X = _a[0], Y = _a[1];
            if (direction)
                Y = y + i;
            else
                X = x + i;
            this.board[Y][X] = 1;
            if (show) {
                this.htmlBoard[Y][X].classList.add('blue');
            }
        }
    };
    Board.prototype.drawShips = function (shipSizes) {
        while (shipSizes.length > 0) {
            var size = shipSizes.pop();
            var found = false;
            while (!found) {
                var _a = [Math.floor(Math.random() * this.width), Math.floor(Math.random() * this.height), Math.random() < 0.5], x = _a[0], y = _a[1], direction = _a[2];
                if (x > this.width - size && !direction) {
                    continue;
                }
                if (y > this.height - size && direction) {
                    continue;
                }
                if (size === 4) {
                    this.addShip(x, y, size, direction);
                    break;
                }
                var s = {
                    x: x,
                    y: y,
                    direction: direction,
                    size: size
                };
                var _b = generateCheckPositions(s, this.width, this.height), shipsPos = _b[0], surroundings = _b[1];
                found = this.checkPositions(shipsPos, surroundings);
                if (found)
                    this.addShip(x, y, size, direction);
            }
        }
    };
    Board.prototype.checkPositions = function (ships, surroundings) {
        var _this = this;
        var s = ships.filter(function (pos) {
            return _this.board[pos[1]][pos[0]] === 0;
        });
        var sur = surroundings.filter(function (pos) {
            return _this.board[pos[1]][pos[0]] === 0;
        });
        return (ships.length === s.length && surroundings.length === sur.length);
    };
    Board.prototype.viewShip = function (color, s) {
        var x = s.x, y = s.y, direction = s.direction, size = s.size;
        for (var i = 0; i < size; i++) {
            var _a = [x, y], X = _a[0], Y = _a[1];
            if (direction)
                Y = y + i;
            else
                X = x + i;
            if (X >= 0 && X < this.width && Y >= 0 && Y < this.height) {
                this.htmlBoard[Y][X].style.backgroundColor = color;
            }
        }
        this.lastProposed = s;
    };
    Board.prototype.checkShip = function (e, shipSetter, view) {
        if (!shipSetter.selected)
            return false;
        var el = e.target;
        var pos = el.id.split("-").map(function (a) { return parseInt(a); });
        var ship = {
            x: pos[0],
            y: pos[1],
            direction: shipSetter.direction,
            size: shipSetter.selected
        };
        if (ship.x + ship.size > this.width && !ship.direction) {
            ship.x = this.width - ship.size;
        }
        if (ship.y + ship.size > this.height && ship.direction) {
            ship.y = this.width - ship.size;
        }
        var _a = generateCheckPositions(ship, this.width, this.height), shipsPos = _a[0], surroundings = _a[1];
        var shipValid = this.checkPositions(shipsPos, surroundings);
        if (view) {
            if (this.lastProposed) {
                this.viewShip("", this.lastProposed);
            }
            this.viewShip(shipValid ? "green" : "red", ship);
        }
        return shipValid;
    };
    Board.prototype.updateLastShip = function (dir) {
        if (!this.lastProposed)
            return;
        var s = __assign({}, this.lastProposed);
        s.direction = dir;
        this.viewShip("", this.lastProposed);
        this.viewShip("green", s);
    };
    Board.prototype.checkAndAddShip = function (e, shipS) {
        if (this.checkShip(e, shipS, false)) {
            this.viewShip("", this.lastProposed);
            var _a = this.lastProposed, x = _a.x, y = _a.y, direction = _a.direction, size = _a.size;
            this.addShip(x, y, size, direction, true);
            document.getElementsByClassName("selected")[0].remove();
            shipS.selected = null;
        }
    };
    return Board;
}());
exports.default = Board;
function generateCheckPositions(ship, width, height) {
    var x = ship.x, y = ship.y, size = ship.size, direction = ship.direction;
    var positions = [];
    for (var i = -1; i < 2; i++) {
        if (!direction) {
            for (var j = -1; j < size + 1; j++) {
                positions.push([x + j, y + i]);
            }
        }
        else {
            for (var j = -1; j < size + 1; j++) {
                positions.push([x + i, y + j]);
            }
        }
    }
    var shipPos = positions.splice(size + 3, size);
    return [shipPos, positions.filter(function (pos) {
            return (pos[0] >= 0 && pos[0] < width) && (pos[1] >= 0 && pos[1] < height);
        })];
}
},{}],3:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ShipSetter = /** @class */ (function () {
    function ShipSetter(ships) {
        var _this = this;
        this.getContainer = function () { return _this.container; };
        this.updateDirection = function () { return _this.direction = !_this.direction; };
        this.isSetting = function () { return _this.selected != null; };
        this.direction = true;
        this.ships = ships.slice();
        this.container = document.getElementById("ships");
        this.selected = Math.max.apply(Math, ships);
        for (var i = ships.length - 1; i >= 0; i--) {
            var ship = document.createElement("div");
            ship.id = "" + ships[i];
            ship.className = "ship";
            ship.addEventListener("click", function (e) {
                var a = document.getElementsByClassName("selected")[0];
                if (a)
                    a.classList.remove("selected");
                var el = e.currentTarget;
                el.classList.add('selected');
                _this.selected = parseInt(el.id);
            });
            for (var j = 0; j < ships[i]; j++) {
                var cell = document.createElement("div");
                ship.appendChild(cell);
            }
            this.container.appendChild(ship);
        }
        document.getElementsByClassName('ship')[0].classList.add("selected");
    }
    return ShipSetter;
}());
exports.default = ShipSetter;
},{}],4:[function(require,module,exports){
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var config_1 = require("./../config");
var Board_1 = require("./Board");
var ShipSetter_1 = require("./ShipSetter");
var board = config_1.config.board, shipsSizes = config_1.config.shipsSizes;
var machineBoard = new Board_1.default(board[0], board[1]);
var playerBoard = new Board_1.default(board[0], board[1]);
var shipSetter = new ShipSetter_1.default(shipsSizes);
machineBoard.createHTMLBoard();
playerBoard.createHTMLBoard(shipSetter);
document.getElementById("machine").appendChild(machineBoard.getHMTLBoard());
document.getElementById("player").appendChild(playerBoard.getHMTLBoard());
machineBoard.drawShips(shipsSizes.slice());
document.body.addEventListener("contextmenu", function (e) {
    e.preventDefault();
    if (shipSetter.isSetting()) {
        shipSetter.updateDirection();
        playerBoard.updateLastShip(shipSetter.direction);
    }
});
},{"./../config":1,"./Board":2,"./ShipSetter":3}]},{},[4])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29uZmlnLnRzIiwic3JjL3RzL0JvYXJkLnRzIiwic3JjL3RzL1NoaXBTZXR0ZXIudHMiLCJzcmMvdHMvbWFpbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDS2EsUUFBQSxNQUFNLEdBQVc7SUFDMUIsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQztJQUNmLFVBQVUsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztDQUM3QyxDQUFBOzs7Ozs7Ozs7Ozs7Ozs7QUNKRCxJQUFJLE1BQU0sR0FBYSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBUzFEO0lBUUksZUFBWSxLQUFhLEVBQUUsTUFBYzs7UUFQekMsVUFBSyxHQUFlLEVBQUUsQ0FBQztRQUd2QixjQUFTLEdBQW9CLEVBQUUsQ0FBQztRQUVoQyxVQUFLLEdBQVcsRUFBRSxDQUFDO1FBQ25CLGlCQUFZLEdBQWdCLElBQUksQ0FBQztRQUU3QixvQkFBMkMsRUFBMUMsa0JBQVUsRUFBRSxtQkFBVyxDQUFvQjtRQUM1QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzdCLElBQU0sR0FBRyxHQUFhLEVBQUUsQ0FBQztZQUN6QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUM1QixHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ2Y7WUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQTtTQUN2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WUFBWSxDQUFDLGVBQWUsRUFBRSxDQUFBO0FBQzlCLFdBQVcsQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7QUFFeEMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7QUFDNUUsUUFBUSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUM7QUFFMUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztBQUUzQyxRQUFRLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGFBQWEsRUFBRSxVQUFBLENBQUM7SUFDM0MsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ25CLElBQUcsVUFBVSxDQUFDLFNBQVMsRUFBRSxFQUFFO1FBQ3ZCLFVBQVUsQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUM3QixXQUFXLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztLQUNwRDtBQUNMLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW50ZXJmYWNlIENvbmZpZyB7XG4gICAgYm9hcmQ6IG51bWJlcltdO1xuICAgIHNoaXBzU2l6ZXM6IG51bWJlcltdXG59XG5cbmV4cG9ydCBjb25zdCBjb25maWc6IENvbmZpZyA9IHtcbiAgICBib2FyZDogWzEwLCAxMF0sXG4gICAgc2hpcHNTaXplczogWzEsIDEsIDEsIDEsIDIsIDIsIDIsIDMsIDMsIDRdXG59XG5cbiIsImltcG9ydCBDZWxsIGZyb20gJy4vQ2VsbCc7XHJcbmltcG9ydCBTaGlwIGZyb20gJy4vU2hpcCc7XHJcbmltcG9ydCBTaGlwU2V0dGVyIGZyb20gJy4vU2hpcFNldHRlcic7XHJcblxyXG5sZXQgY29sb3JzOiBzdHJpbmdbXSA9IFtcImJsdWVcIiwgXCJyZWRcIiwgXCJncmVlblwiLCBcInllbGxvd1wiXTtcclxuXHJcbmludGVyZmFjZSBzaGlwU2V0dGluZyB7XHJcbiAgICB4OiBudW1iZXI7XHJcbiAgICB5OiBudW1iZXI7XHJcbiAgICBkaXJlY3Rpb246IGJvb2xlYW47XHJcbiAgICBzaXplOiBudW1iZXI7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvYXJkIHtcclxuICAgIGJvYXJkOiBudW1iZXJbXVtdID0gW107XHJcbiAgICB3aWR0aDogbnVtYmVyO1xyXG4gICAgaGVpZ2h0OiBudW1iZXI7XHJcbiAgICBodG1sQm9hcmQ6IEhUTUxFbGVtZW50W11bXSA9IFtdO1xyXG4gICAgYm9hcmRDb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gICAgc2hpcHM6IFNoaXBbXSA9IFtdO1xyXG4gICAgbGFzdFByb3Bvc2VkOiBzaGlwU2V0dGluZyA9IG51bGw7XHJcbiAgICBjb25zdHJ1Y3Rvcih3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xyXG4gICAgICAgIFt0aGlzLndpZHRoLCB0aGlzLmhlaWdodF0gPSBbd2lkdGgsIGhlaWdodF07XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCByb3c6IG51bWJlcltdID0gW107XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgd2lkdGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgcm93LnB1c2goMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5ib2FyZC5wdXNoKHJvdylcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjcmVhdGVIVE1MQm9hcmQoc2hpcFNldHRlcjogU2hpcFNldHRlciA9IG51bGwpIHtcclxuICAgICAgICB0aGlzLmJvYXJkQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxyXG4gICAgICAgIHRoaXMuYm9hcmRDb250YWluZXIuY2xhc3NOYW1lID0gXCJib2FyZFwiO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5oZWlnaHQ7IGkrKykge1xyXG4gICAgICAgICAgICBjb25zdCByb3c6IEhUTUxFbGVtZW50W10gPSBbXTtcclxuICAgICAgICAgICAgY29uc3Qgcm93RGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgIHJvd0Rpdi5jbGFzc05hbWUgPSBcInJvd1wiO1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMud2lkdGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2hpcFNldHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VvdmVyJywgKGUpID0+IHRoaXMuY2hlY2tTaGlwKGUsIHNoaXBTZXR0ZXIsIHRydWUpKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHRoaXMuY2hlY2tBbmRBZGRTaGlwKGUsIHNoaXBTZXR0ZXIpKTtcclxuXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTmFtZSA9IFwiY2VsbFwiO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5pZCA9IGAke2p9LSR7aX1gO1xyXG4gICAgICAgICAgICAgICAgcm93LnB1c2goY2VsbCk7XHJcbiAgICAgICAgICAgICAgICByb3dEaXYuYXBwZW5kQ2hpbGQoY2VsbCk7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaHRtbEJvYXJkLnB1c2gocm93KVxyXG4gICAgICAgICAgICB0aGlzLmJvYXJkQ29udGFpbmVyLmFwcGVuZENoaWxkKHJvd0Rpdik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0SE1UTEJvYXJkKCkgeyByZXR1cm4gdGhpcy5ib2FyZENvbnRhaW5lciB9XHJcbiAgICBhZGRTaGlwKHg6IG51bWJlciwgeTogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgZGlyZWN0aW9uOmJvb2xlYW4sIHNob3c6Ym9vbGVhbiA9IGZhbHNlKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICBsZXQgW1gsIFldID0gW3gsIHldO1xyXG4gICAgICAgICAgICBpZiAoZGlyZWN0aW9uKSBZID0geSArIGk7XHJcbiAgICAgICAgICAgIGVsc2UgWCA9IHggKyBpO1xyXG4gICAgICAgICAgICB0aGlzLmJvYXJkW1ldW1hdID0gMTtcclxuICAgICAgICAgICAgaWYoc2hvdyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmh0bWxCb2FyZFtZXVtYXS5jbGFzc0xpc3QuYWRkKCdibHVlJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBkcmF3U2hpcHMoc2hpcFNpemVzOiBudW1iZXJbXSkge1xyXG4gICAgICAgIHdoaWxlIChzaGlwU2l6ZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zdCBzaXplID0gc2hpcFNpemVzLnBvcCgpO1xyXG4gICAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgd2hpbGUgKCFmb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IFt4LCB5LCBkaXJlY3Rpb25dID0gW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRoaXMud2lkdGgpLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmhlaWdodCksIE1hdGgucmFuZG9tKCkgPCAwLjVdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHggPiB0aGlzLndpZHRoIC0gc2l6ZSAmJiAhZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoeSA+IHRoaXMuaGVpZ2h0IC0gc2l6ZSAmJiBkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChzaXplID09PSA0KSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkU2hpcCh4LCB5LCBzaXplLCBkaXJlY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzOnNoaXBTZXR0aW5nID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHgsXHJcbiAgICAgICAgICAgICAgICAgICAgeSxcclxuICAgICAgICAgICAgICAgICAgICBkaXJlY3Rpb24sXHJcbiAgICAgICAgICAgICAgICAgICAgc2l6ZVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uc3QgW3NoaXBzUG9zLCBzdXJyb3VuZGluZ3NdID0gZ2VuZXJhdGVDaGVja1Bvc2l0aW9ucyhzLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICBmb3VuZCA9IHRoaXMuY2hlY2tQb3NpdGlvbnMoc2hpcHNQb3MsIHN1cnJvdW5kaW5ncylcclxuICAgICAgICAgICAgICAgIGlmIChmb3VuZCkgdGhpcy5hZGRTaGlwKHgsIHksIHNpemUsIGRpcmVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjaGVja1Bvc2l0aW9ucyhzaGlwczogbnVtYmVyW11bXSwgc3Vycm91bmRpbmdzOiBudW1iZXJbXVtdKTogYm9vbGVhbiB7XHJcbiAgICAgICAgY29uc3QgcyA9IHNoaXBzLmZpbHRlcihwb3MgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ib2FyZFtwb3NbMV1dW3Bvc1swXV0gPT09IDBcclxuICAgICAgICB9KVxyXG4gICAgICAgIGNvbnN0IHN1ciA9IHN1cnJvdW5kaW5ncy5maWx0ZXIocG9zID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYm9hcmRbcG9zWzFdXVtwb3NbMF1dID09PSAwXHJcbiAgICAgICAgfSlcclxuICAgICAgICByZXR1cm4gKHNoaXBzLmxlbmd0aCA9PT0gcy5sZW5ndGggJiYgc3Vycm91bmRpbmdzLmxlbmd0aCA9PT0gc3VyLmxlbmd0aClcclxuICAgIH1cclxuICAgIHZpZXdTaGlwKGNvbG9yOiBzdHJpbmcsIHM6IHNoaXBTZXR0aW5nKSB7XHJcbiAgICAgICAgY29uc3QgeyB4LCB5LCBkaXJlY3Rpb24sIHNpemUgfSA9IHM7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaXplOyBpKyspIHtcclxuICAgICAgICAgICAgbGV0IFtYLCBZXSA9IFt4LCB5XTtcclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbikgWSA9IHkgKyBpO1xyXG4gICAgICAgICAgICBlbHNlIFggPSB4ICsgaTtcclxuICAgICAgICAgICAgaWYgKFggPj0gMCAmJiBYIDwgdGhpcy53aWR0aCAmJiBZID49IDAgJiYgWSA8IHRoaXMuaGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmh0bWxCb2FyZFtZXVtYXS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxhc3RQcm9wb3NlZCA9IHM7XHJcbiAgICB9XHJcblxyXG4gICAgY2hlY2tTaGlwKGU6IEV2ZW50LCBzaGlwU2V0dGVyOiBTaGlwU2V0dGVyLCB2aWV3OmJvb2xlYW4pIHtcclxuICAgICAgICBpZighc2hpcFNldHRlci5zZWxlY3RlZCkgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIGNvbnN0IGVsID0gZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgY29uc3QgcG9zID0gZWwuaWQuc3BsaXQoXCItXCIpLm1hcChhID0+IHBhcnNlSW50KGEpKTtcclxuICAgICAgICBjb25zdCBzaGlwOiBzaGlwU2V0dGluZyA9IHtcclxuICAgICAgICAgICAgeDogcG9zWzBdLFxyXG4gICAgICAgICAgICB5OiBwb3NbMV0sXHJcbiAgICAgICAgICAgIGRpcmVjdGlvbjogc2hpcFNldHRlci5kaXJlY3Rpb24sXHJcbiAgICAgICAgICAgIHNpemU6IHNoaXBTZXR0ZXIuc2VsZWN0ZWRcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHNoaXAueCArIHNoaXAuc2l6ZSA+IHRoaXMud2lkdGggJiYgIXNoaXAuZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHNoaXAueCA9IHRoaXMud2lkdGggLSBzaGlwLnNpemU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzaGlwLnkgKyBzaGlwLnNpemUgPiB0aGlzLmhlaWdodCAmJiBzaGlwLmRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICBzaGlwLnkgPSB0aGlzLndpZHRoIC0gc2hpcC5zaXplO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBbc2hpcHNQb3MsIHN1cnJvdW5kaW5nc10gPSBnZW5lcmF0ZUNoZWNrUG9zaXRpb25zKHNoaXAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcclxuICAgICAgICBjb25zdCBzaGlwVmFsaWQgPSB0aGlzLmNoZWNrUG9zaXRpb25zKHNoaXBzUG9zLCBzdXJyb3VuZGluZ3MpO1xyXG4gICAgICAgIGlmKHZpZXcpe1xyXG4gICAgICAgICAgICBpZiAodGhpcy5sYXN0UHJvcG9zZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld1NoaXAoXCJcIiwgdGhpcy5sYXN0UHJvcG9zZWQpO1xyXG4gICAgICAgICAgICB9ICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMudmlld1NoaXAoc2hpcFZhbGlkID8gXCJncmVlblwiIDogXCJyZWRcIiwgc2hpcCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzaGlwVmFsaWQ7XHJcbiAgICB9XHJcbiAgICB1cGRhdGVMYXN0U2hpcChkaXI6IGJvb2xlYW4pIHtcclxuICAgICAgICBpZiAoIXRoaXMubGFzdFByb3Bvc2VkKSByZXR1cm47XHJcbiAgICAgICAgY29uc3QgcyA9IHsgLi4udGhpcy5sYXN0UHJvcG9zZWQgfTtcclxuICAgICAgICBzLmRpcmVjdGlvbiA9IGRpcjtcclxuICAgICAgICB0aGlzLnZpZXdTaGlwKFwiXCIsIHRoaXMubGFzdFByb3Bvc2VkKTtcclxuICAgICAgICB0aGlzLnZpZXdTaGlwKFwiZ3JlZW5cIiwgcyk7XHJcbiAgICB9XHJcbiAgICBjaGVja0FuZEFkZFNoaXAoZTogRXZlbnQsIHNoaXBTOiBTaGlwU2V0dGVyKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tTaGlwKGUsIHNoaXBTLCBmYWxzZSkpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3U2hpcChcIlwiLCB0aGlzLmxhc3RQcm9wb3NlZCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHsgeCwgeSwgZGlyZWN0aW9uLCBzaXplIH0gPSB0aGlzLmxhc3RQcm9wb3NlZDtcclxuICAgICAgICAgICAgdGhpcy5hZGRTaGlwKHgsIHksIHNpemUsIGRpcmVjdGlvbiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJzZWxlY3RlZFwiKVswXS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgc2hpcFMuc2VsZWN0ZWQgPSBudWxsO1xyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdlbmVyYXRlQ2hlY2tQb3NpdGlvbnMoc2hpcDpzaGlwU2V0dGluZywgd2lkdGg6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpOiBudW1iZXJbXVtdW10ge1xyXG4gICAgY29uc3Qge3gseSxzaXplLCBkaXJlY3Rpb259ID0gc2hpcDtcclxuICAgIGNvbnN0IHBvc2l0aW9uczogbnVtYmVyW11bXSA9IFtdXHJcbiAgICBmb3IgKGxldCBpID0gLTE7IGkgPCAyOyBpKyspIHtcclxuICAgICAgICBpZiAoIWRpcmVjdGlvbikge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gLTE7IGogPCBzaXplICsgMTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbnMucHVzaChbeCArIGosIHkgKyBpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gLTE7IGogPCBzaXplICsgMTsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbnMucHVzaChbeCArIGksIHkgKyBqXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBzaGlwUG9zID0gcG9zaXRpb25zLnNwbGljZShzaXplICsgMywgc2l6ZSk7XHJcbiAgICByZXR1cm4gW3NoaXBQb3MsIHBvc2l0aW9ucy5maWx0ZXIocG9zID0+IHtcclxuICAgICAgICByZXR1cm4gKHBvc1swXSA+PSAwICYmIHBvc1swXSA8IHdpZHRoKSAmJiAocG9zWzFdID49IDAgJiYgcG9zWzFdIDwgaGVpZ2h0KVxyXG4gICAgfSldO1xyXG59XHJcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFNoaXBTZXR0ZXJ7XHJcbiAgICBzaGlwczogbnVtYmVyW107XHJcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50O1xyXG4gICAgc2VsZWN0ZWQ6IG51bWJlcjtcclxuICAgIGRpcmVjdGlvbjogYm9vbGVhbjtcclxuICAgIGNvbnN0cnVjdG9yKHNoaXBzOiBudW1iZXJbXSl7XHJcbiAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2hpcHMgPSBzaGlwcy5zbGljZSgpO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzaGlwc1wiKTtcclxuICAgICAgICB0aGlzLnNlbGVjdGVkID0gTWF0aC5tYXgoLi4uc2hpcHMpO1xyXG4gICAgICAgIGZvciAobGV0IGkgPSBzaGlwcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICBjb25zdCBzaGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgc2hpcC5pZCA9IGAke3NoaXBzW2ldfWA7XHJcbiAgICAgICAgICAgIHNoaXAuY2xhc3NOYW1lID0gXCJzaGlwXCI7XHJcbiAgICAgICAgICAgIHNoaXAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGUgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJzZWxlY3RlZFwiKVswXTtcclxuICAgICAgICAgICAgICAgIGlmKGEpIGEuY2xhc3NMaXN0LnJlbW92ZShcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZWwgPSBlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICBlbC5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZCA9IHBhcnNlSW50KGVsLmlkKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2hpcHNbaV07IGorKykge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICBzaGlwLmFwcGVuZENoaWxkKGNlbGwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHNoaXApO1xyXG4gICAgICAgIH1cclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdzaGlwJylbMF0uY2xhc3NMaXN0LmFkZChcInNlbGVjdGVkXCIpO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG4gICAgZ2V0Q29udGFpbmVyID0gKCkgPT4gdGhpcy5jb250YWluZXI7XHJcbiAgICB1cGRhdGVEaXJlY3Rpb24gPSAoKSA9PiB0aGlzLmRpcmVjdGlvbiA9ICF0aGlzLmRpcmVjdGlvbjtcclxuICAgIGlzU2V0dGluZyA9ICgpID0+IHRoaXMuc2VsZWN0ZWQgIT0gbnVsbDtcclxufSIsImltcG9ydCB7Y29uZmlnfSBmcm9tIFwiLi8uLi9jb25maWdcIjtcclxuaW1wb3J0IEJvYXJkIGZyb20gXCIuL0JvYXJkXCI7XHJcbmltcG9ydCBTaGlwU2V0dGVyIGZyb20gJy4vU2hpcFNldHRlcic7XHJcblxyXG5jb25zdCB7Ym9hcmQsIHNoaXBzU2l6ZXN9ID0gY29uZmlnO1xyXG5cclxuY29uc3QgbWFjaGluZUJvYXJkOiBCb2FyZCA9IG5ldyBCb2FyZChib2FyZFswXSwgYm9hcmRbMV0pO1xyXG5jb25zdCBwbGF5ZXJCb2FyZDogQm9hcmQgPSBuZXcgQm9hcmQoYm9hcmRbMF0sIGJvYXJkWzFdKTtcclxuY29uc3Qgc2hpcFNldHRlciA9IG5ldyBTaGlwU2V0dGVyKHNoaXBzU2l6ZXMpO1xyXG5cclxubWFjaGluZUJvYXJkLmNyZWF0ZUhUTUxCb2FyZCgpXHJcbnBsYXllckJvYXJkLmNyZWF0ZUhUTUxCb2FyZChzaGlwU2V0dGVyKTtcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWFjaGluZVwiKS5hcHBlbmRDaGlsZChtYWNoaW5lQm9hcmQuZ2V0SE1UTEJvYXJkKCkpO1xyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInBsYXllclwiKS5hcHBlbmRDaGlsZChwbGF5ZXJCb2FyZC5nZXRITVRMQm9hcmQoKSk7XHJcblxyXG5tYWNoaW5lQm9hcmQuZHJhd1NoaXBzKHNoaXBzU2l6ZXMuc2xpY2UoKSk7XHJcblxyXG5kb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoXCJjb250ZXh0bWVudVwiLCBlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIGlmKHNoaXBTZXR0ZXIuaXNTZXR0aW5nKCkpIHtcclxuICAgICAgICBzaGlwU2V0dGVyLnVwZGF0ZURpcmVjdGlvbigpO1xyXG4gICAgICAgIHBsYXllckJvYXJkLnVwZGF0ZUxhc3RTaGlwKHNoaXBTZXR0ZXIuZGlyZWN0aW9uKTtcclxuICAgIH1cclxufSk7XHJcbiJdfQ==
